import{i as ir,B as ys,a as Ss,b as ws,j as Pr,d as ue,U as Fr,z as Cs,r as ks,f as _s,Q as vs,e as zs,$ as Is,c as Jt,g as E,h as Rs,C as Ds,k as hr,u as ur,l as te,m as r,H as g,n as e,T as p,o as _n,p as j,s as Es,q as b,t as zt,J as Ts,v,w as Nr,A as Kt,x as Ls,y as Us,M as ye,D as Se,E as we,F as Ce,G as ke,I as Pe,K as Ke,L as Mt,N as As,O as Zt,P as _e,R as D,S as U,V as Ir,W as he,X as re,Y as We,Z as Y,_ as me,a0 as Fe,a1 as Z,a2 as qe,a3 as Gt,a4 as Ps,a5 as dt,a6 as De,a7 as Mr,a8 as pr,a9 as vn,aa as Tt,ab as nt,ac as It,ad as q,ae as ht,af as Xr,ag as Fs,ah as zn,ai as In,aj as Rn,ak as Je,al as Ns,am as Ms,an as Or,ao as Os,ap as Ws,aq as mr,ar as Dn,as as En,at as Wr,au as Ge,av as Jr,aw as $s,ax as js,ay as Bs,az as Rr,aA as Hs,aB as Vs,aC as Gs,aD as qs,aE as Ys,aF as Zs,aG as ze,aH as Qs,aI as Tn,aJ as Xs,aK as Js,aL as $r,aM as ft,aN as Rt,aO as xt,aP as H,aQ as jr,aR as Ks,aS as ut,aT as pt,aU as Ut,aV as mt,aW as eo,aX as Te,aY as Le,aZ as it,a_ as Ue,a$ as Ae,b0 as at,b1 as Kr,b2 as to,b3 as je,b4 as Lt,b5 as Br,b6 as ro,b7 as no,b8 as Ln,b9 as Un,ba as er,bb as st,bc as gt,bd as An,be as so,bf as oo,bg as Dr,bh as kt,bi as lo,bj as Pn,bk as io,bl as vt,bm as xr,bn as en,bo as Fn,bp as Nn,bq as Mn,br as St,bs as On,bt as wt,bu as Wn,bv as ao,bw as Er,bx as co,by as ho,bz as Hr,bA as uo,bB as po,bC as $n,bD as jn,bE as Bn,bF as Re,bG as mo,bH as Ot,bI as Ct,bJ as Hn,bK as go,bL as Vn,bM as Gn,bN as qn,bO as Yn,bP as Zn,bQ as Qn,bR as Xn,bS as Jn,bT as fo,bU as bo,bV as xo,bW as yo,bX as Kn,bY as es,bZ as At,b_ as Pt,b$ as $e,c0 as de,c1 as Ft,c2 as ae,c3 as tn,c4 as So,c5 as wo,c6 as Co,c7 as Nt,c8 as ts,c9 as rs,ca as ns,cb as ko,cc as _o,cd as vo,ce as zo,cf as Io,cg as Ro,ch as Do,ci as Eo,cj as To,ck as Lo,cl as Uo,cm as Ao,cn as Po,co as Fo,cp as No,cq as Mo,cr as Oo,cs as Wo,ct as $o}from"./vendor.db58c8a3.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerpolicy&&(i.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?i.credentials="include":l.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}})();ir.use(ys).use(Ss).use(ws).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:Pr(["/","statics/locales/{{lng}}.json"])}},function(t,s){ue.locale(ir.language)});ir.on("languageChanged",t=>{ue.locale(t)});Fr("zh-cn",Cs);Fr("ru",ks);Fr("fa",_s);const Tr=new vs,ss=t=>{const s=document.querySelector('meta[name="theme-color"]');s==null||s.setAttribute("content",t=="dark"?"#1A202C":"#3B81F6")},jo=zs({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",primary:{50:"#9cb7f2",100:"#88a9ef",200:"#749aec",300:"#618ce9",400:"#4d7de7",500:"#396fe4",600:"#3364cd",700:"#2e59b6",800:"#284ea0",900:"#224389"},gray:{750:"#222C3B"}},components:{Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}}}});const ar=()=>localStorage.getItem("token"),Bo=t=>{localStorage.setItem("token",t)},Ho=()=>{localStorage.removeItem("token")},Vo=Is.create({baseURL:"/api/"}),Go=(t,s={})=>(ar()&&(s.headers={...(s==null?void 0:s.headers)||{},Authorization:`Bearer ${ar()}`}),Vo(t,s)),B=Go,qo=Jt(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:"",fetchCoreSettings:()=>{t({isLoading:!0}),Promise.all([B("/core").then(({version:s,started:n,logs_websocket:o})=>t({version:s,started:n,logs_websocket:o})),B("/core/config").then(s=>t({config:s}))]).finally(()=>t({isLoading:!1}))},updateConfig:s=>(t({isPostLoading:!0}),B("/core/config",{method:"PUT",body:s}).finally(()=>{t({isPostLoading:!1})})),restartCore:()=>B("/core/restart",{method:"POST"})}));function Oe(t,s=2,n=!1){if(!+t)return"0 B";const o=1024,l=s<0?0:s,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],d=Math.floor(Math.log(t)/Math.log(o));return n?[parseFloat((t/Math.pow(o,d)).toFixed(l)),i[d]]:`${parseFloat((t/Math.pow(o,d)).toFixed(l))} ${i[d]}`}const rn=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Yo=E(Rs,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Zo=E(Ds,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Qo=E(hr,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),yr=({title:t,content:s,icon:n})=>r(_n,{p:6,borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{borderColor:"gray.600",bg:"gray.750"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[r(g,{alignItems:"center",columnGap:"4",children:[e(j,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:n}),e(p,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(j,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:s})]}),Lr="statistics-query-key",Xo=t=>{const{version:s}=$(),{data:n}=ur({queryKey:Lr,queryFn:()=>B("/system"),refetchInterval:5e3,onSuccess:({version:l})=>{s!==l&&$.setState({version:l})}}),{t:o}=te();return r(g,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...t,children:[e(yr,{title:o("activeUsers"),content:n&&r(g,{alignItems:"flex-end",children:[e(p,{children:rn(n.users_active)}),r(p,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",rn(n.total_user)]})]}),icon:e(Yo,{})}),e(yr,{title:o("dataUsage"),content:n&&Oe(n.incoming_bandwidth+n.outgoing_bandwidth),icon:e(Zo,{})}),e(yr,{title:o("memoryUsage"),content:n&&r(g,{alignItems:"flex-end",children:[e(p,{children:Oe(n.mem_used,1,!0)[0]}),r(p,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:[Oe(n.mem_used,1,!0)[1]," /"," ",Oe(n.mem_total,1)]})]}),icon:e(Qo,{})})]})},os="marzban-num-users-per-page",nn=10,Jo=()=>{const t=localStorage.getItem(os)||nn.toString();return parseInt(t)||nn},Ko=t=>localStorage.setItem(os,t),el=t=>{for(const s in t)t[s]||delete t[s];return $.setState({loading:!0}),B("/users",{query:t}).then(s=>($.setState({users:s}),s)).finally(()=>{$.setState({loading:!1})})},tl=()=>B("/inbounds").then(t=>{$.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{$.setState({loading:!1})}),$=Jt(Es((t,s)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0},loading:!0,isResetingAllUsage:!1,isEditingHosts:!1,isEditingNodes:!1,isEditingSubscription:!1,isShowingNodesUsage:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:Jo(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:()=>{el(s().filters)},resetAllUsage:async()=>{await B("/nodes/reset",{method:"POST"}),s().onResetAllUsage(!1),s().refetchUsers()},onResetAllUsage:n=>t({isResetingAllUsage:n}),onCreateUser:n=>t({isCreatingNewUser:n}),onEditingUser:n=>{t({editingUser:n})},onDeletingUser:n=>{t({deletingUser:n})},onFilterChange:n=>{t({filters:{...s().filters,...n}}),s().refetchUsers()},setQRCode:n=>{t({QRcodeLinks:n})},deleteUser:n=>(t({editingUser:null}),B(`/user/${n.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),s().refetchUsers(),Tr.invalidateQueries(Lr)})),createUser:n=>B("/user",{method:"POST",body:n}).then(()=>{t({editingUser:null}),s().refetchUsers(),Tr.invalidateQueries(Lr)}),editUser:n=>B(`/user/${n.username}`,{method:"PUT",body:n}).then(()=>{s().onEditingUser(null),s().refetchUsers()}),fetchUserUsage:(n,o)=>{for(const l in o)o[l]||delete o[l];return B(`/user/${n.username}/usage`,{method:"GET",query:o})},fetchUserUsageTop10(n){return B("/user/usage/top10",{query:n})},onEditingHosts:n=>{t({isEditingHosts:n})},onEditingNodes:n=>{t({isEditingNodes:n})},onEditingSubscription:n=>{t({isEditingSubscription:n})},onShowingNodesUsage:n=>{t({isShowingNodesUsage:n})},setSubLink:n=>{t({subscribeUrl:n})},resetDataUsage:n=>B(`/user/${n.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),s().refetchUsers()}),revokeSubscription:n=>B(`/user/${n.username}/revoke_sub`,{method:"POST"}).then(o=>{t({revokeSubscriptionUser:null,editingUser:o}),s().refetchUsers()})}))),ve=({children:t,color:s})=>e(j,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${s}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${s}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${s}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${s}.400`}},children:e(p,{color:`${s}.500`,_dark:{color:`${s}.900`},position:"relative",zIndex:"2",children:t})});window.ace.define("ace/theme/nord_dark",["require","exports","module","ace/lib/dom"],(t,s,n)=>{s.isDark=!0,s.cssClass="ace-nord-dark",t("../lib/dom").importCssString(s.cssText,s.cssClass)});window.ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],(t,s,n)=>{s.isDark=!1,s.cssClass="ace-dawn",t("../lib/dom").importCssString(s.cssText,s.cssClass)});const rl=b.exports.forwardRef(({json:t,onChange:s,mode:n="code"},o)=>{const{colorMode:l}=zt(),i={mode:n,onChangeText:s,statusBar:!1,mainMenuBar:!1,theme:l==="dark"?"ace/theme/nord_dark":"ace/theme/dawn"},d=b.exports.useRef(null),x=b.exports.useRef(null);return b.exports.useEffect(()=>(x.current=new Ts(d.current,i),()=>{x.current&&x.current.destroy()}),[]),b.exports.useEffect(()=>{x.current&&x.current.update(t)},[t]),e(j,{ref:o,border:"1px solid",borderColor:"gray.300",_dark:{borderColor:"gray.500"},borderRadius:5,h:"full",children:e(j,{height:"full",ref:d})})}),ls=v.object({name:v.string().min(1),address:v.string().min(1),port:v.number().min(1).or(v.string().transform(t=>parseFloat(t))),api_port:v.number().min(1).or(v.string().transform(t=>parseFloat(t))),xray_version:v.string().nullable().optional(),id:v.number().nullable().optional(),status:v.enum(["connected","connecting","error","disabled"]).nullable().optional(),message:v.string().nullable().optional(),add_as_new_host:v.boolean().optional(),usage_coefficient:v.number().or(v.string().transform(t=>parseFloat(t)))}),nl=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",usage_coefficient:1}),Qt="fetch-nodes-query-key",is=()=>{const{isEditingNodes:t}=$();return ur({queryKey:Qt,queryFn:tr.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},tr=Jt((t,s)=>({nodes:[],addNode(n){return B("/node",{method:"POST",body:n})},fetchNodes(){return B("/nodes")},fetchNodesUsage(n){return B("/nodes/usage",{query:n})},updateNode(n){return B(`/node/${n.id}`,{method:"PUT",body:n})},setDeletingNode(n){t({deletingNode:n})},reconnectNode(n){return B(`/node/${n.id}/reconnect`,{method:"POST"})},deleteNode:()=>{var n;return B(`/node/${(n=s().deletingNode)==null?void 0:n.id}`,{method:"DELETE"})}})),sn=500,sl=E(Nr,{baseStyle:{w:5,h:5}}),ol=E(Kt,{baseStyle:{w:4,h:4}}),ll=E(Ls,{baseStyle:{w:4,h:4}}),il=E(Us,{baseStyle:{w:3,h:3}}),al=t=>({[Gt.ReadyState.CONNECTING]:"connecting",[Gt.ReadyState.OPEN]:"connected",[Gt.ReadyState.CLOSING]:"closed",[Gt.ReadyState.CLOSED]:"closed",[Gt.ReadyState.UNINSTANTIATED]:"closed"})[t],cl=t=>{try{let s=new URL("/api/".startsWith("/")?window.location.origin+"/api/":"/api/");return(s.protocol==="https:"?"wss://":"ws://")+Pr([s.host+s.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+ar()}catch(s){return console.error("Unable to generate websocket url"),console.error(s),null}};let yt=[];const dl=()=>{const{colorMode:t}=zt(),{data:s}=is(),n=!1,[o,l]=b.exports.useState(""),i=(W,G)=>{W!==o&&(W==="host"?(l(""),c([])):(l(W),c([])))},{isEditingCore:d}=$(),{fetchCoreSettings:x,updateConfig:y,isLoading:R,config:w,isPostLoading:C,version:h,restartCore:m}=qo(),_=b.exports.useRef(null),[T,c]=b.exports.useState([]),{t:a}=te(),u=Pe(),S=Ke({defaultValues:{config:w||{}}});b.exports.useEffect(()=>{w&&S.setValue("config",w)},[w]),b.exports.useEffect(()=>{d&&x()},[d]);const M=b.exports.useRef(!0),P=b.exports.useCallback(Mt(W=>{var ne,ce,K;const G=Math.abs((((ne=_.current)==null?void 0:ne.scrollTop)||0)-(((ce=_.current)==null?void 0:ce.scrollHeight)||0)+(((K=_.current)==null?void 0:K.offsetHeight)||0))<10;_.current&&G?M.current=!0:M.current=!1,W.length<40&&c(W)},300),[]),{readyState:k}=As(cl(o),{onMessage:W=>{yt.push(W.data),yt.length>sn&&(yt=yt.splice(0,yt.length-sn)),P([...yt])},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});b.exports.useEffect(()=>{var W;_.current&&M.current&&(_.current.scrollTop=(W=_.current)==null?void 0:W.scrollHeight)},[T]),b.exports.useEffect(()=>()=>{yt=[]},[]);const f=al(k.toString()),{mutate:z,isLoading:O}=Zt(m),le=({config:W})=>{y(W).then(()=>{u({title:a("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(G=>{let ne=a("core.generalErrorMessage");typeof G.response._data.detail=="object"&&(ne=G.response._data.detail[Object.keys(G.response._data.detail)[0]]),typeof G.response._data.detail=="string"&&(ne=G.response._data.detail),u({title:ne,status:"error",isClosable:!0,position:"top",duration:3e3})})},X=b.exports.useRef(null),[I,J]=b.exports.useState(!1),F=()=>{var W;document.fullscreenElement?(document.exitFullscreen(),J(!1)):((W=X.current)==null||W.requestFullscreen(),J(!0))};return r("form",{onSubmit:S.handleSubmit(le),children:[r(_e,{children:[r(D,{children:[r(g,{justifyContent:"space-between",alignItems:"flex-start",children:[r(U,{children:[a("core.configuration")," ",R&&e(Ir,{isIndeterminate:!0,size:"15px"})]}),e(g,{gap:0,children:e(he,{label:"Xray Version",placement:"top",children:e(re,{height:"100%",textTransform:"lowercase",children:h&&`v${h}`})})})]}),r(j,{position:"relative",ref:X,minHeight:"300px",children:[e(We,{control:S.control,name:"config",render:({field:W})=>e(rl,{json:w,onChange:W.onChange})}),e(Y,{size:"xs","aria-label":"full screen",variant:"ghost",position:"absolute",top:"2",right:"4",onClick:F,children:I?e(il,{}):e(ll,{})})]})]}),r(D,{mt:"4",children:[r(g,{justifyContent:"space-between",style:{paddingBottom:"1rem"},children:[r(g,{children:[(s==null?void 0:s[0])&&r(me,{size:"sm",style:{width:"auto"},disabled:n,bg:"transparent",_dark:{bg:"transparent"},sx:{option:{backgroundColor:t==="dark"?"#222C3B":"white"}},onChange:W=>i(W.currentTarget.value,W.currentTarget.selectedOptions[0].text),children:[e("option",{value:"host",defaultChecked:!0,children:"Master"},"host"),s&&s.map(W=>e("option",{value:String(W.id),children:a(W.name)},W.address))]}),e(U,{className:"w-au",children:a("core.logs")})]}),e(p,{as:U,children:a(`core.socket.${f}`)})]}),e(j,{border:"1px solid",borderColor:"gray.300",bg:"#F9F9F9",_dark:{borderColor:"gray.500",bg:"#2e3440"},borderRadius:5,minHeight:"200px",maxHeight:"250px",p:2,overflowY:"auto",ref:_,children:T.map((W,G)=>e(p,{fontSize:"xs",opacity:.8,whiteSpace:"pre-line",children:W},G))})]})]}),e(Fe,{children:r(g,{w:"full",justifyContent:"space-between",children:[e(g,{children:e(j,{children:e(Z,{size:"sm",leftIcon:e(ol,{className:qe({"animate-spin":O})}),onClick:()=>z(),children:a(O?"core.restarting":"core.restartCore")})})}),e(g,{children:e(Z,{size:"sm",variant:"solid",colorScheme:"primary",px:"5",type:"submit",isDisabled:R||C,isLoading:C,children:a("core.save")})})]})})]})},hl=()=>{const{isEditingCore:t}=$(),s=$.setState.bind(null,{isEditingCore:!1}),{t:n}=te();return r(ye,{isOpen:t,onClose:s,size:"3xl",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",w:"full",children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:e(sl,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:n("core.title")})]})}),e(ke,{mt:3}),e(dl,{})]})]})},ot=E(Ps,{baseStyle:{w:5,h:5}}),ul=()=>{const[t,s]=b.exports.useState(!1),{deletingUser:n,onDeletingUser:o,deleteUser:l}=$(),{t:i}=te(),d=Pe(),x=()=>{o(null)},y=()=>{n&&(s(!0),l(n).then(()=>{d({title:i("deleteUser.deleteSuccess",{username:n.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(x).finally(s.bind(null,!1)))};return r(ye,{isCentered:!0,isOpen:!!n,onClose:x,size:"sm",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",children:[e(Ce,{pt:6,children:e(ve,{color:"red",children:e(ot,{})})}),e(ke,{mt:3}),r(_e,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:i("deleteUser.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(dt,{components:{b:e("b",{})},children:i("deleteUser.prompt",{username:n.username})})})]}),r(Fe,{display:"flex",children:[e(Z,{size:"sm",onClick:x,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(Z,{size:"sm",w:"full",colorScheme:"red",onClick:y,leftIcon:t?e(De,{size:"xs"}):void 0,children:i("delete")})]})]})]})},Vr={baseStyle:{w:4,h:4}},pl=E(Mr,Vr),ml=E(pr,Vr),Gr=E(Kt,Vr),gl=Mt(t=>{$.getState().onFilterChange({...$.getState().filters,offset:0,search:t})},300),fl=({...t})=>{const{loading:s,filters:n,onFilterChange:o,refetchUsers:l,onCreateUser:i}=$(),{t:d}=te(),[x,y]=b.exports.useState(""),R=C=>{y(C.target.value),gl(C.target.value)},w=()=>{y(""),o({...n,offset:0,search:""})};return r(vn,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},position:"sticky",top:0,mx:"-6",px:"6",rowGap:4,gap:{lg:4,base:0},bg:"var(--chakra-colors-chakra-body-bg)",py:4,zIndex:"docked",...t,children:[e(Tt,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:r(nt,{children:[e(It,{pointerEvents:"none",children:e(pl,{})}),e(q,{placeholder:d("search"),value:x,borderColor:"light-border",onChange:R}),r(ht,{children:[s&&e(De,{size:"xs"}),n.search&&n.search.length>0&&e(Y,{onClick:w,"aria-label":"clear",size:"xs",variant:"ghost",children:e(ml,{})})]})]})}),e(Tt,{colSpan:2,order:{base:1,md:2},children:r(g,{justifyContent:"flex-end",alignItems:"center",h:"full",children:[e(Y,{"aria-label":"refresh users",disabled:s,onClick:l,size:"sm",variant:"outline",children:e(Gr,{className:qe({"animate-spin":s})})}),e(Z,{colorScheme:"primary",size:"sm",onClick:()=>i(!0),px:5,children:d("createUser")})]})})]})},as="https://github.com/Gozargah/Marzban",bl="https://github.com/Gozargah",xl="https://github.com/Gozargah/Marzban#donation",cs=t=>{const{version:s}=$();return e(g,{w:"full",py:"0",position:"relative",...t,children:r(p,{display:"inline-block",flexGrow:1,textAlign:"center",color:"gray.500",fontSize:"xs",children:[e(Xr,{color:"blue.400",href:as,children:"Marzban"}),s?` (v${s}), `:", ","Made with \u2764\uFE0F in"," ",e(Xr,{color:"blue.400",href:bl,children:"Gozargah"})]})})},yl=E(Fs,{baseStyle:{w:4,h:4}}),ds=({actions:t})=>{const{i18n:s}=te();var n=o=>{s.changeLanguage(o)};return r(zn,{placement:"bottom-end",children:[e(In,{as:Y,size:"sm",variant:"outline",icon:e(yl,{}),position:"relative"}),r(Rn,{minW:"100px",className:"menuList",zIndex:99999,children:[e(Je,{maxW:"100px",fontSize:"sm",onClick:()=>n("en"),children:"English"}),e(Je,{maxW:"100px",fontSize:"sm",onClick:()=>n("fa"),children:"\u0641\u0627\u0631\u0633\u06CC"}),e(Je,{maxW:"100px",fontSize:"sm",onClick:()=>n("zh-cn"),children:"\u7B80\u4F53\u4E2D\u6587"}),e(Je,{maxW:"100px",fontSize:"sm",onClick:()=>n("ru"),children:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439"})]})]})},Sl=async()=>await B("/admin"),wl=()=>{const{data:t,isError:s,isLoading:n,isSuccess:o,error:l}=ur({queryFn:()=>Sl()});return{userData:t||{discord_webook:"",is_sudo:!1,telegram_id:"",username:""},getUserIsPending:n,getUserIsSuccess:o,getUserIsError:s,getUserError:l}},et={baseStyle:{w:4,h:4}},Cl=E(Ns,et),kl=E(Ms,et),_l=E(Nr,et),vl=E(Or,et),zl=E(Os,et),Il=E(Ws,et),Rl=E(mr,et),Dl=E(Dn,et),El=E(hr,et),Tl=E(En,et),Ll=E(Wr,et),on=E(j,{baseStyle:{bg:"yellow.500",w:"2",h:"2",rounded:"full",position:"absolute"}}),hs="marzban-menu-notification",Ul=()=>{const t=localStorage.getItem(hs);if(!t)return!0;try{return t&&js(parseInt(t))?Bs(new Date,new Date(parseInt(t)))>=7:!0}catch{return!0}},Al=({actions:t})=>{const{userData:s,getUserIsSuccess:n,getUserIsPending:o}=wl(),l=()=>!o&&n?s.is_sudo:!1,{onEditingHosts:i,onResetAllUsage:d,onEditingNodes:x,onShowingNodesUsage:y,onEditingSubscription:R}=$(),{t:w}=te(),{colorMode:C,toggleColorMode:h}=zt(),[m,_]=b.exports.useState(Ul()),T=C==="dark"?"dark_dimmed":C,c=()=>{localStorage.setItem(hs,new Date().getTime().toString()),_(!1)};return r(g,{gap:2,justifyContent:"space-between",__css:{"& .menuList":{direction:"ltr"}},position:"relative",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:w("users")}),m&&e(on,{top:"0",right:"0",zIndex:9999}),e(j,{overflow:"auto",css:{direction:"rtl"},children:r(g,{alignItems:"center",children:[r(zn,{children:[e(In,{as:Y,size:"sm",variant:"outline",icon:e(Ge,{children:e(vl,{})}),position:"relative"}),r(Rn,{minW:"170px",zIndex:99999,className:"menuList",children:[l()&&r(Ge,{children:[e(Je,{maxW:"170px",fontSize:"sm",icon:e(Rl,{}),onClick:i.bind(null,!0),children:w("header.hostSettings")}),e(Je,{maxW:"170px",fontSize:"sm",icon:e(Dl,{}),onClick:x.bind(null,!0),children:w("header.nodeSettings")}),e(Je,{maxW:"210px",fontSize:"sm",icon:e(Ll,{}),onClick:R.bind(null,!0),children:w("header.subscriptionSetting")}),e(Je,{maxW:"210px",fontSize:"sm",icon:e(El,{}),onClick:y.bind(null,!0),children:w("header.nodesUsage")}),e(Je,{maxW:"170px",fontSize:"sm",icon:e(Tl,{}),onClick:d.bind(null,!0),children:w("resetAllUsage")})]}),e(Jr,{to:xl,target:"_blank",children:r(Je,{maxW:"170px",fontSize:"sm",icon:e(Il,{}),position:"relative",onClick:c,children:[w("header.donation")," ",m&&e(on,{top:"3",right:"2"})]})}),e(Jr,{to:"/login",children:e(Je,{maxW:"170px",fontSize:"sm",icon:e(zl,{}),children:w("header.logout")})})]})]}),l()&&e(Y,{size:"sm",variant:"outline","aria-label":"core settings",onClick:()=>{$.setState({isEditingCore:!0})},children:e(_l,{})}),e(ds,{}),e(Y,{size:"sm",variant:"outline","aria-label":"switch theme",onClick:()=>{ss(C=="dark"?"light":"dark"),h()},children:C==="light"?e(Cl,{}):e(kl,{})}),e(j,{css:{direction:"ltr"},display:"flex",alignItems:"center",pr:"2",__css:{"&  span":{display:"inline-flex"}},children:e($s,{href:as,"data-color-scheme":`no-preference: ${T}; light: ${T}; dark: ${T};`,"data-size":"large","data-show-count":"true","aria-label":"Star Marzban on GitHub",children:"Star"})})]})})]})},Pl=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],us=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],ps=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],Fl=[{title:"none",value:""},{title:"xtls-rprx-vision",value:"xtls-rprx-vision"}],Nl=["aes-128-gcm","aes-256-gcm","chacha20-ietf-poly1305"],Ml=Jt(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),B("/hosts").then(s=>t({hosts:s})).finally(()=>t({isLoading:!1}))},setHosts:s=>(t({isPostLoading:!0}),B("/hosts",{method:"PUT",body:s}).finally(()=>{t({isPostLoading:!1})}))}));const Ol=E(pr,{baseStyle:{w:4,h:4}}),rt=Rr.forwardRef(({disabled:t,step:s,label:n,className:o,startAdornment:l,endAdornment:i,type:d="text",placeholder:x,onChange:y,onBlur:R,name:w,value:C,onClick:h,error:m,clearable:_=!1,...T},c)=>{const a=()=>{y&&y({target:{value:"",name:w}})},{size:u="md"}=T,S=d=="number"?Qs:q,M=d=="number"?Hs:Rr.Fragment,P=d=="number"?{keepWithinRange:!0,precision:5,format:k=>isNaN(parseFloat(String(k)))||Number(parseFloat(String(k)).toFixed(5))===0?k:Number(parseFloat(String(k)).toFixed(5)),min:0,step:s,name:w,type:d,placeholder:x,onChange:k=>{y&&y(k)},onBlur:R,value:C,onClick:h,disabled:t,flexGrow:1,size:u}:{};return r(D,{isInvalid:!!m,children:[n&&e(U,{children:n}),r(nt,{size:u,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[l&&e(Vs,{children:l}),r(M,{...P,children:[e(S,{name:w,ref:c,step:s,className:qe(o),type:d,placeholder:x,onChange:y,onBlur:R,value:C,onClick:h,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...T,roundedLeft:l?"0":"md",roundedRight:i?"0":"md"}),d=="number"&&e(Ge,{children:r(Gs,{children:[e(qs,{}),e(Ys,{})]})})]}),i&&e(Zs,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),_&&C&&C.length&&e(ht,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:a,cursor:"pointer",children:e(Ol,{})})]}),!!m&&e(ze,{children:m})]})}),Wl=E(Tn,{baseStyle:{w:5,h:5}}),$l=E(Xs,{baseStyle:{w:5,h:5}}),jl=E(Js,{baseStyle:{w:5,h:5}}),Sr=E(me,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),bt=E(rt,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),Bl=E(mr,{baseStyle:{w:5,h:5}}),ct=E($r,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Hl=v.record(v.string().min(1),v.array(v.object({remark:v.string().min(1,"Remark is required"),address:v.string().min(1,"Address is required"),port:v.string().or(v.number()).nullable().transform(t=>typeof t=="number"?t:t!==null&&!isNaN(parseInt(t))?Number(parseInt(t)):null),path:v.string().nullable(),sni:v.string().nullable(),host:v.string().nullable(),mux_enable:v.boolean().default(!1),allowinsecure:v.boolean().nullable().default(!1),is_disabled:v.boolean().default(!0),fragment_setting:v.string().nullable(),noise_setting:v.string().nullable(),random_user_agent:v.boolean().default(!1),security:v.string(),alpn:v.string(),fingerprint:v.string(),use_sni_as_host:v.boolean().default(!1)}))),Xe=E(ze,{baseStyle:{color:"red.400",display:"block",textAlign:"left",w:"100%"}}),Vl=({hostKey:t,isOpen:s,toggleAccordion:n})=>{const{inbounds:o}=$(),l=[...o.values()].flat().filter(a=>a.tag===t)[0],i=jr(),{fields:d,append:x,remove:y,insert:R,move:w}=Ks({control:i.control,name:t}),{errors:C}=i.formState,{t:h}=te(),m=C[t],_=()=>{x({host:"",sni:"",port:null,path:null,address:"",remark:"",mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1})},T=a=>{if(a<0||a>=d.length)return;const u=d[a];R(a+1,u)};b.exports.useEffect(()=>{m&&!s&&n()},[m]);const c=(a,u)=>{u==="up"&&a>0?w(a,a-1):u==="down"&&a<d.length-1&&w(a,a+1)};return r(ut,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[r(pt,{px:2,borderRadius:"3px",onClick:n,children:[e(p,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:t}),e(Ut,{})]}),e(mt,{px:2,pb:2,children:r(H,{gap:3,children:[d.map((a,u)=>{var S,M,P,k,f,z,O,le,X,I,J,F,W,G,ne,ce,K,fe,N,L,ee,V,ie,Q,se,Ie,He,Ye,Ze,Qe,Ee,xe,A,oe,Ne,Ve,tt,lt,be,$t,jt,Bt,Ht,Vt,Dt;return e(eo.div,{layout:!0,initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{layout:{type:"spring",stiffness:500,damping:30},opacity:{duration:.1}},id:a.id,whileDrag:{scale:1.05,zIndex:10},style:{width:"100%"},children:r(H,{id:a.id,border:"1px solid",_dark:{borderColor:"gray.600",bg:"#273142"},_light:{borderColor:"gray.200",bg:"#fcfbfb"},p:2,w:"full",borderRadius:"4px",children:[e(g,{w:"100%",alignItems:"flex-start",children:r(D,{position:"relative",zIndex:10,isInvalid:!!(m&&((S=m[u])==null?void 0:S.remark)),children:[r(nt,{children:[e(bt,{...i.register(t+"."+u+".remark"),size:"sm",borderRadius:"4px",placeholder:"Remark"}),e(ht,{children:r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(j,{mt:"-8px",children:e(ct,{})})}),e(it,{children:r(Ue,{children:[e(Ae,{}),e(at,{}),e(Kr,{children:r(j,{fontSize:"xs",children:[e(p,{pr:"20px",children:h("hostsDialog.desc")}),r(p,{children:[r(re,{children:["{","SERVER_IP","}"]})," ",h("hostsDialog.currentServer")]}),r(p,{mt:1,children:[r(re,{children:["{","SERVER_IPV6","}"]})," ",h("hostsDialog.currentServerv6")]}),r(p,{mt:1,children:[r(re,{children:["{","USERNAME","}"]})," ",h("hostsDialog.username")]}),r(p,{mt:1,children:[r(re,{children:["{","DATA_USAGE","}"]})," ",h("hostsDialog.dataUsage")]}),r(p,{mt:1,children:[r(re,{children:["{","DATA_LEFT","}"]})," ",h("hostsDialog.remainingData")]}),r(p,{mt:1,children:[r(re,{children:["{","DATA_LIMIT","}"]})," ",h("hostsDialog.dataLimit")]}),r(p,{mt:1,children:[r(re,{children:["{","DAYS_LEFT","}"]})," ",h("hostsDialog.remainingDays")]}),r(p,{mt:1,children:[r(re,{children:["{","EXPIRE_DATE","}"]})," ",h("hostsDialog.expireDate")]}),r(p,{mt:1,children:[r(re,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",h("hostsDialog.jalaliExpireDate")]}),r(p,{mt:1,children:[r(re,{children:["{","TIME_LEFT","}"]})," ",h("hostsDialog.remainingTime")]}),r(p,{mt:1,children:[r(re,{children:["{","STATUS_TEXT","}"]})," ",h("hostsDialog.statusText")]}),r(p,{mt:1,children:[r(re,{children:["{","STATUS_EMOJI","}"]})," ",h("hostsDialog.statusEmoji")]}),r(p,{mt:1,children:[r(re,{children:["{","PROTOCOL","}"]})," ",h("hostsDialog.proxyProtocol")]}),r(p,{mt:1,children:[r(re,{children:["{","TRANSPORT","}"]})," ",h("hostsDialog.proxyMethod")]})]})})]})})]})})]}),m&&((M=m[u])==null?void 0:M.remark)&&e(Xe,{children:(k=(P=m[u])==null?void 0:P.remark)==null?void 0:k.message})]})}),r(D,{isInvalid:!!(m&&((f=m[u])==null?void 0:f.address)),children:[r(nt,{children:[e(bt,{size:"sm",borderRadius:"4px",placeholder:"Address (e.g. example.com)",...i.register(t+"."+u+".address")}),e(ht,{children:r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(j,{mt:"-8px",children:e(ct,{})})}),e(it,{children:r(Ue,{children:[e(Ae,{}),e(at,{}),e(Kr,{children:r(j,{fontSize:"xs",children:[e(p,{pr:"20px",children:h("hostsDialog.desc")}),r(p,{children:[r(re,{children:["{","SERVER_IP","}"]})," ",h("hostsDialog.currentServer")]}),r(p,{mt:1,children:[r(re,{children:["{","SERVER_IPV6","}"]})," ",h("hostsDialog.currentServerv6")]}),r(p,{mt:1,children:[r(re,{children:["{","USERNAME","}"]})," ",h("hostsDialog.username")]}),r(p,{mt:1,children:[r(re,{children:["{","DATA_USAGE","}"]})," ",h("hostsDialog.dataUsage")]}),r(p,{mt:1,children:[r(re,{children:["{","DATA_LEFT","}"]})," ",h("hostsDialog.remainingData")]}),r(p,{mt:1,children:[r(re,{children:["{","DATA_LIMIT","}"]})," ",h("hostsDialog.dataLimit")]}),r(p,{mt:1,children:[r(re,{children:["{","DAYS_LEFT","}"]})," ",h("hostsDialog.remainingDays")]}),r(p,{mt:1,children:[r(re,{children:["{","EXPIRE_DATE","}"]})," ",h("hostsDialog.expireDate")]}),r(p,{mt:1,children:[r(re,{children:["{","JALALI_EXPIRE_DATE","}"]})," ",h("hostsDialog.jalaliExpireDate")]}),r(p,{mt:1,children:[r(re,{children:["{","TIME_LEFT","}"]})," ",h("hostsDialog.remainingTime")]}),r(p,{mt:1,children:[r(re,{children:["{","STATUS_TEXT","}"]})," ",h("hostsDialog.statusText")]}),r(p,{mt:1,children:[r(re,{children:["{","STATUS_EMOJI","}"]})," ",h("hostsDialog.statusEmoji")]}),r(p,{mt:1,children:[r(re,{children:["{","PROTOCOL","}"]})," ",h("hostsDialog.proxyProtocol")]}),r(p,{mt:1,children:[r(re,{children:["{","TRANSPORT","}"]})," ",h("hostsDialog.proxyMethod")]})]})})]})})]})})]}),m&&((z=m[u])==null?void 0:z.address)&&e(Xe,{children:(le=(O=m[u])==null?void 0:O.address)==null?void 0:le.message})]}),e(xt,{w:"full",allowToggle:!0,children:r(ut,{border:"0",children:[r("div",{style:{display:"flex",alignItems:"center"},children:[r(pt,{display:"flex",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:[r(p,{flex:"3",align:"start",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[h("hostsDialog.advancedOptions"),e(Ut,{fontSize:"sm",ml:1})]}),r(to,{flex:"1",px:"0",display:"contents",children:[e(We,{control:i.control,name:`${t}.${u}.is_disabled`,render:({field:Me})=>e(je,{mx:"1.5",colorScheme:"primary",...Me,value:void 0,isChecked:!Me.value,onChange:Qr=>{console.log(Qr.target.checked),Me.onChange(!Qr.target.checked)}})}),e(he,{label:"Delete",placement:"top",children:e(Y,{"aria-label":"Delete",size:"sm",colorScheme:"red",variant:"ghost",onClick:y.bind(null,u),children:e(ot,{})})})]})]}),e(he,{label:"Duplicate",placement:"top",children:e(Y,{"aria-label":"Duplicate",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>T(u),children:e(Wl,{})})}),u<d.length-1&&e(he,{label:"Move Down",placement:"top",children:e(Y,{"aria-label":"DownIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>c(u,"down"),children:e(jl,{})})}),u>0&&e(he,{label:"Move Up",placement:"top",children:e(Y,{"aria-label":"UpIcon",size:"sm",colorScheme:"white",variant:"ghost",onClick:()=>c(u,"up"),children:e($l,{})})})]}),e(mt,{w:"full",p:1,children:r(H,{w:"full",borderRadius:"4px",children:[r(D,{isInvalid:!!(m&&((X=m[u])==null?void 0:X.port)),children:[r(U,{display:"flex",pb:1,alignItems:"center",justifyContent:"space-between",gap:1,m:"0",children:[e("span",{children:h("hostsDialog.port")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ct,{})}),e(it,{children:r(Ue,{p:2,children:[e(Ae,{}),e(at,{}),e(p,{fontSize:"xs",pr:5,children:h("hostsDialog.port.info")})]})})]})]}),e(bt,{size:"sm",borderRadius:"4px",placeholder:String(l.port||"8080"),type:"number",...i.register(t+"."+u+".port")})]}),r(D,{isInvalid:!!(m&&((I=m[u])==null?void 0:I.sni)),children:[r(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:h("hostsDialog.sni")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ct,{})}),e(it,{children:r(Ue,{p:2,children:[e(Ae,{}),e(at,{}),e(p,{fontSize:"xs",pr:5,children:h("hostsDialog.sni.info")}),e(p,{fontSize:"xs",mt:"2",children:e(dt,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(re,{})}})}),e(p,{fontSize:"xs",children:e(dt,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(re,{})}})})]})})]})]}),e(bt,{size:"sm",borderRadius:"4px",placeholder:"SNI (e.g. example.com)",...i.register(t+"."+u+".sni")}),m&&((J=m[u])==null?void 0:J.sni)&&e(Xe,{children:(W=(F=m[u])==null?void 0:F.sni)==null?void 0:W.message})]}),r(D,{isInvalid:!!(m&&((G=m[u])==null?void 0:G.host)),children:[r(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:h("hostsDialog.host")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ct,{})}),e(it,{children:r(Ue,{p:2,children:[e(Ae,{}),e(at,{}),e(p,{fontSize:"xs",pr:5,children:h("hostsDialog.host.info")}),e(p,{fontSize:"xs",mt:"2",children:e(dt,{i18nKey:"hostsDialog.host.wildcard",components:{badge:e(re,{})}})}),e(p,{fontSize:"xs",children:e(dt,{i18nKey:"hostsDialog.host.multiHost",components:{badge:e(re,{})}})})]})})]})]}),e(bt,{size:"sm",borderRadius:"4px",placeholder:"Host (e.g. example.com)",...i.register(t+"."+u+".host")}),m&&((ne=m[u])==null?void 0:ne.host)&&e(Xe,{children:(K=(ce=m[u])==null?void 0:ce.host)==null?void 0:K.message})]}),r(D,{isInvalid:!!(m&&((fe=m[u])==null?void 0:fe.path)),children:[r(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:h("hostsDialog.path")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ct,{})}),e(it,{children:r(Ue,{p:2,children:[e(Ae,{}),e(at,{}),e(p,{fontSize:"xs",pr:5,children:h("hostsDialog.path.info")})]})})]})]}),e(bt,{size:"sm",borderRadius:"4px",placeholder:"path (e.g. /vless)",...i.register(t+"."+u+".path")}),m&&((N=m[u])==null?void 0:N.path)&&e(Xe,{children:(ee=(L=m[u])==null?void 0:L.path)==null?void 0:ee.message})]}),r(D,{height:"66px",children:[r(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:h("hostsDialog.security")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ct,{})}),e(it,{children:r(Ue,{p:2,children:[e(Ae,{}),e(at,{}),e(p,{fontSize:"xs",pr:5,children:h("hostsDialog.security.info")})]})})]})]}),e(Sr,{size:"sm",...i.register(t+"."+u+".security"),children:Pl.map(Me=>e("option",{value:Me.value,children:Me.title},Me.value))})]}),r(D,{height:"66px",children:[e(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:h("hostsDialog.alpn")})}),e(Sr,{size:"sm",...i.register(t+"."+u+".alpn"),children:us.map(Me=>e("option",{value:Me.value,children:Me.title},Me.value))})]}),r(D,{height:"66px",children:[e(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:e("span",{children:h("hostsDialog.fingerprint")})}),e(Sr,{size:"sm",...i.register(t+"."+u+".fingerprint"),children:ps.map(Me=>e("option",{value:Me.value,children:Me.title},Me.value))})]}),r(D,{isInvalid:!!(m&&((V=m[u])==null?void 0:V.fragment_setting)),children:[r(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:h("hostsDialog.fragment")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ct,{})}),e(it,{children:r(Ue,{p:2,children:[e(Ae,{}),e(at,{}),e(p,{fontSize:"xs",pr:5,children:h("hostsDialog.fragment.info")}),e(p,{fontSize:"xs",pr:5,pt:2,pb:1,children:h("hostsDialog.fragment.info.examples")}),e(p,{fontSize:"xs",pr:5,children:"100-200,10-20,tlshello"}),e(p,{fontSize:"xs",pr:5,children:"100-200,10-20,1-3"}),e(p,{fontSize:"xs",pr:5,pt:"3",children:h("hostsDialog.fragment.info.attention")})]})})]})]}),e(bt,{size:"sm",borderRadius:"4px",placeholder:"Fragment settings by pattern",...i.register(t+"."+u+".fragment_setting")}),m&&((ie=m[u])==null?void 0:ie.fragment_setting)&&e(Xe,{children:(se=(Q=m[u])==null?void 0:Q.fragment_setting)==null?void 0:se.message})]}),r(D,{isInvalid:!!(m&&((Ie=m[u])==null?void 0:Ie.noise_setting)),children:[r(U,{display:"flex",pb:1,alignItems:"center",gap:1,justifyContent:"space-between",m:"0",children:[e("span",{children:h("hostsDialog.noise")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(ct,{})}),e(it,{children:r(Ue,{p:2,children:[e(Ae,{}),e(at,{}),e(p,{fontSize:"xs",pr:5,children:h("hostsDialog.noise.info")}),e(p,{fontSize:"xs",pr:5,pt:2,pb:1,children:h("hostsDialog.noise.info.examples")}),e(p,{fontSize:"xs",pr:5,children:"rand:10-20,10-20"}),e(p,{fontSize:"xs",pr:5,children:"rand:10-20,10-20&base64:7nQBAAABAAAAAAAABnQtcmluZwZtc2VkZ2UDbmV0AAABAAE=,10-25"}),e(p,{fontSize:"xs",pr:5,pt:"3",children:h("hostsDialog.noise.info.attention")})]})})]})]}),e(bt,{size:"sm",borderRadius:"4px",placeholder:"Noise settings by pattern",...i.register(t+"."+u+".noise_setting")}),m&&((He=m[u])==null?void 0:He.noise_setting)&&e(Xe,{children:(Ze=(Ye=m[u])==null?void 0:Ye.noise_setting)==null?void 0:Ze.message})]}),r(D,{isInvalid:!!(m&&((Qe=m[u])==null?void 0:Qe.use_sni_as_host)),children:[e(Lt,{...i.register(t+"."+u+".use_sni_as_host"),children:e(U,{children:h("hostsDialog.useSniAsHost")})}),m&&((Ee=m[u])==null?void 0:Ee.use_sni_as_host)&&e(Xe,{children:(A=(xe=m[u])==null?void 0:xe.use_sni_as_host)==null?void 0:A.message})]}),e(D,{isInvalid:!!(m&&((oe=m[u])==null?void 0:oe.allowinsecure)),children:r(Lt,{...i.register(t+"."+u+".allowinsecure"),name:t+"."+u+".allowinsecure",children:[e(U,{children:h("hostsDialog.allowinsecure")}),m&&((Ne=m[u])==null?void 0:Ne.allowinsecure)&&e(Xe,{children:(tt=(Ve=m[u])==null?void 0:Ve.allowinsecure)==null?void 0:tt.message})]})}),r(D,{isInvalid:!!(m&&((lt=m[u])==null?void 0:lt.mux_enable)),children:[e(Lt,{...i.register(t+"."+u+".mux_enable"),children:e(U,{children:h("hostsDialog.muxEnable")})}),m&&((be=m[u])==null?void 0:be.mux_enable)&&e(Xe,{children:(jt=($t=m[u])==null?void 0:$t.mux_enable)==null?void 0:jt.message})]}),r(D,{isInvalid:!!(m&&((Bt=m[u])==null?void 0:Bt.random_user_agent)),children:[e(Lt,{...i.register(t+"."+u+".random_user_agent"),children:e(U,{children:h("hostsDialog.randomUserAgent")})}),m&&((Ht=m[u])==null?void 0:Ht.random_user_agent)&&e(Xe,{children:(Dt=(Vt=m[u])==null?void 0:Vt.random_user_agent)==null?void 0:Dt.message})]})]},u)})]})})]},a.id)},a.id)}),e(Z,{variant:"outline",w:"full",size:"sm",color:"",fontWeight:"normal",onClick:_,children:h("hostsDialog.addHost")})]})})]})},Gl=()=>{const{isEditingHosts:t,onEditingHosts:s,refetchUsers:n,inbounds:o}=$(),{isLoading:l,hosts:i,fetchHosts:d,isPostLoading:x,setHosts:y}=Ml(),R=Pe(),{t:w}=te(),[C,h]=b.exports.useState({});b.exports.useEffect(()=>{t&&d()},[t]);const m=Ke({resolver:ft(Hl)});b.exports.useEffect(()=>{i&&t&&m.reset(i)},[i]);const _=()=>{h({}),s(!1)},T=a=>{y(a).then(()=>{R({title:w("hostsDialog.savedSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3}),n()}).catch(u=>{var S,M,P,k,f;(((S=u==null?void 0:u.response)==null?void 0:S.status)===409||((M=u==null?void 0:u.response)==null?void 0:M.status)===400)&&R({title:(k=(P=u.response)==null?void 0:P._data)==null?void 0:k.detail,status:"error",isClosable:!0,position:"top",duration:3e3}),((f=u==null?void 0:u.response)==null?void 0:f.status)===422&&Object.keys(u.response._data.detail).forEach(z=>{R({title:u.response._data.detail[z]+" ("+z+")",status:"error",isClosable:!0,position:"top",duration:3e3})})})},c=a=>{C[String(a)]?delete C[String(a)]:C[String(a)]={},h({...C})};return r(ye,{isOpen:t,onClose:_,children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(Ce,{pt:6,children:e(ve,{color:"primary",children:e(Bl,{color:"white"})})}),e(ke,{mt:3}),e(_e,{w:"440px",pb:3,pt:3,children:e(Rt,{...m,children:r("form",{onSubmit:m.handleSubmit(T),children:[e(p,{mb:3,opacity:.8,fontSize:"sm",children:w("hostsDialog.title")}),l&&w("hostsDialog.loading"),!l&&i&&(Object.keys(i).length>0?e(xt,{w:"full",allowToggle:!0,allowMultiple:!0,index:Object.keys(C).map(a=>parseInt(a)),children:e(H,{w:"full",children:Object.keys(i).map((a,u)=>e(Vl,{toggleAccordion:()=>c(u),isOpen:C[String(u)],hostKey:a},a))})}):"No inbound found. Please check your Xray config file."),e(g,{justifyContent:"flex-end",py:2,children:e(Z,{variant:"solid",mt:"2",type:"submit",colorScheme:"primary",size:"sm",px:5,isLoading:x,disabled:x,children:w("hostsDialog.apply")})})]})})})]})]})},qr=(t,s,n)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return s({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&n){Object.keys(t.response._data.detail).forEach(o=>n.setError(o,{message:t.response._data.detail[o]}));return}}return s({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Yr=(t,s)=>s({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),ql=({deleteCallback:t})=>{const{deleteNode:s,deletingNode:n,setDeletingNode:o}=tr(),{t:l}=te(),i=Pe(),d=Br(),x=()=>{o(null)},{isLoading:y,mutate:R}=Zt(s,{onSuccess:()=>{Yr(l("deleteNode.deleteSuccess",{name:n&&n.name}),i),o(null),d.invalidateQueries(Qt),t&&t()},onError:w=>{qr(w,i)}});return r(ye,{isCentered:!0,isOpen:!!n,onClose:x,size:"sm",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",children:[e(Ce,{pt:6,children:e(ve,{color:"red",children:e(ot,{})})}),e(ke,{mt:3}),r(_e,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:l("deleteNode.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(dt,{components:{b:e("b",{})},children:l("deleteNode.prompt",{name:n.name})})})]}),r(Fe,{display:"flex",children:[e(Z,{size:"sm",onClick:x,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Z,{size:"sm",w:"full",colorScheme:"red",onClick:()=>R(),leftIcon:y?e(De,{size:"xs"}):void 0,children:l("delete")})]})]})]})},rr={baseStyle:{strokeWidth:"2px",w:4,h:4}},ln=E(ro,rr),Yl=E(no,rr),an=E(Ln,rr),cn=E(Un,rr),Zl=E(Un,rr),Ur=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],_t={active:{statusColor:"green",bandWidthColor:"primary",icon:ln},connected:{statusColor:"green",bandWidthColor:"primary",icon:ln},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:Yl},expired:{statusColor:"orange",bandWidthColor:"orange",icon:cn},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Zl},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:cn},limited:{statusColor:"red",bandWidthColor:"red",icon:an},error:{statusColor:"red",bandWidthColor:"red",icon:an}},gr=t=>{let s={status:"",time:""};if(t){ue(t*1e3).utc().isAfter(ue().utc())?s.status="expires":s.status="expired";const n=[],o=ue.duration(ue(t*1e3).utc().diff(ue()));o.years()!=0&&n.push(Math.abs(o.years())+" year"+(Math.abs(o.years())!=1?"s":"")),o.months()!=0&&n.push(Math.abs(o.months())+" month"+(Math.abs(o.months())!=1?"s":"")),o.days()!=0&&n.push(Math.abs(o.days())+" day"+(Math.abs(o.days())!=1?"s":"")),n.length===0&&(o.hours()!=0&&n.push(Math.abs(o.hours())+" hour"+(Math.abs(o.hours())!=1?"s":"")),o.minutes()!=0&&n.push(Math.abs(o.minutes())+" min"+(Math.abs(o.minutes())!=1?"s":""))),s.time=n.join(", "),ir.language.toLocaleLowerCase()==="zh-cn"&&(s.time=s.time.replace(/year[s]?/,"\u5E74"),s.time=s.time.replace(/month[s]?/,"\u4E2A\u6708"),s.time=s.time.replace(/day[s]?/,"\u5929"),s.time=s.time.replace(/hour[s]?/,"\u5C0F\u65F6"),s.time=s.time.replace(/min[s]?/,"\u5206\u949F"),s.time=s.time.replace(/,/g,""),s.status=="expires"?s.time+="\u5185":s.time+="\u524D")}return s},Ql=({expiryDate:t,status:s,compact:n=!1,showDetail:o=!0,extraText:l})=>{const{t:i}=te(),d=gr(t),x=_t[s].icon;return r(Ge,{children:[r(re,{colorScheme:_t[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:n?1:2,alignItems:"center",children:[e(x,{w:n?3:4}),o&&r(p,{textTransform:"capitalize",fontSize:n?".7rem":".875rem",lineHeight:n?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&i(`nodeModal.status.${s}`),l&&`: ${l}`]})]}),o&&t&&e(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(d.status,{time:d.time})})]})},qt=E(rt,{baseStyle:{bg:"white",_dark:{bg:"gray.700"}}}),Xl=E(Dn,{baseStyle:{w:5,h:5}}),Jl=E(er,{baseStyle:{w:5,h:5,strokeWidth:2}}),Kl=({toggleAccordion:t,node:s})=>{const{updateNode:n,reconnectNode:o,setDeletingNode:l}=tr(),{t:i}=te(),d=Br(),x=Pe(),y=Ke({defaultValues:s,resolver:ft(ls)}),R=l.bind(null,s),{isLoading:w,mutate:C}=Zt(n,{onSuccess:()=>{Yr("Node updated successfully",x),d.invalidateQueries(Qt)},onError:T=>{qr(T,x,y)}}),{isLoading:h,mutate:m}=Zt(o.bind(null,s),{onSuccess:()=>{d.invalidateQueries(Qt)}}),_=h?"connecting":s.status?s.status:"error";return r(ut,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[r(pt,{px:2,borderRadius:"3px",onClick:t,children:[r(g,{w:"full",justifyContent:"space-between",pr:2,children:[e(p,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},children:s.name}),r(g,{children:[s.xray_version&&e(re,{colorScheme:"blue",rounded:"full",display:"inline-flex",px:3,py:1,children:r(p,{textTransform:"capitalize",fontSize:"0.7rem",fontWeight:"medium",letterSpacing:"tighter",children:["Xray ",s.xray_version]})}),s.status&&e(Ql,{status:_,compact:!0})]})]}),e(Ut,{})]}),r(mt,{px:2,pb:2,children:[e(H,{pb:3,alignItems:"flex-start",children:_==="error"&&e(st,{status:"error",size:"xs",children:r(j,{children:[r(g,{w:"full",children:[e(gt,{w:4}),e(p,{marginInlineEnd:0,children:s.message})]}),e(g,{justifyContent:"flex-end",w:"full",children:e(Z,{size:"sm","aria-label":"reconnect node",leftIcon:e(Gr,{}),onClick:()=>m(),disabled:h,children:i(h?"nodes.reconnecting":"nodes.reconnect")})})]})})}),e(ms,{form:y,mutate:C,isLoading:w,submitBtnText:i("nodes.editNode"),btnLeftAdornment:e(he,{label:i("delete"),placement:"top",children:e(Y,{colorScheme:"red",variant:"ghost",size:"sm","aria-label":"delete node",onClick:R,children:e(ot,{})})})})]})]})},ei=({toggleAccordion:t,resetAccordions:s})=>{const n=Pe(),{t:o}=te(),l=Br(),{addNode:i}=tr(),d=Ke({resolver:ft(ls),defaultValues:{...nl(),add_as_new_host:!1}}),{isLoading:x,mutate:y}=Zt(i,{onSuccess:()=>{Yr(o("nodes.addNodeSuccess",{name:d.getValues("name")}),n),l.invalidateQueries(Qt),d.reset(),s()},onError:R=>{qr(R,n,d)}});return r(ut,{border:"1px solid",_dark:{borderColor:"gray.600"},_light:{borderColor:"gray.200"},borderRadius:"4px",p:1,w:"full",children:[e(pt,{px:2,borderRadius:"3px",onClick:t,children:r(p,{as:"span",fontWeight:"medium",fontSize:"sm",flex:"1",textAlign:"left",color:"gray.700",_dark:{color:"gray.300"},display:"flex",gap:1,children:[e(Jl,{display:"inline-block"})," ",e("span",{children:o("nodes.addNewMarzbanNode")})]})}),e(mt,{px:2,py:4,children:e(ms,{form:d,mutate:y,isLoading:x,submitBtnText:o("nodes.addNode"),btnProps:{variant:"solid"},addAsHost:!0})})]})},ms=({form:t,mutate:s,isLoading:n,submitBtnText:o,btnProps:l={},btnLeftAdornment:i,addAsHost:d=!1})=>{var m,_,T,c,a,u,S,M,P,k,f,z,O,le,X;const{t:x}=te(),[y,R]=b.exports.useState(!1),{data:w,isLoading:C}=ur({queryKey:"node-settings",queryFn:()=>B("/node/settings")});function h(I){if(document.body.createTextRange){const J=document.body.createTextRange();J.moveToElementText(I),J.select()}else if(window.getSelection){const J=window.getSelection(),F=document.createRange();F.selectNodeContents(I),J.removeAllRanges(),J.addRange(F)}else console.warn("Could not select text in node: Unsupported browser.")}return e("form",{onSubmit:t.handleSubmit(I=>s(I)),children:r(H,{children:[w&&w.certificate&&e(st,{status:"info",alignItems:"start",children:r(An,{display:"flex",flexDirection:"column",overflow:"hidden",children:[e("span",{children:x("nodes.connection-hint")}),r(g,{justify:"end",py:2,children:[e(Z,{as:"a",colorScheme:"primary",size:"xs",download:"ssl_client_cert.pem",href:URL.createObjectURL(new Blob([w.certificate],{type:"text/plain"})),children:x("nodes.download-certificate")}),e(he,{placement:"top",label:x("nodes.show-certificate"),children:e(Y,{"aria-label":x("nodes.show-certificate"),onClick:R.bind(null,!y),colorScheme:"whiteAlpha",color:"primary",size:"xs",children:y?e(oo,{width:"15px"}):e(so,{width:"15px"})})})]}),e(Dr,{in:y,animateOpacity:!0,children:e(p,{bg:"rgba(255,255,255,.5)",_dark:{bg:"rgba(255,255,255,.2)"},rounded:"md",p:"2",lineHeight:"1.2",fontSize:"10px",fontFamily:"Courier",whiteSpace:"pre",overflow:"auto",onClick:I=>{h(I.target)},children:w.certificate})})]})}),r(g,{w:"full",children:[e(D,{children:e(qt,{label:x("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...t.register("name"),error:(T=(_=(m=t.formState)==null?void 0:m.errors)==null?void 0:_.name)==null?void 0:T.message})}),e(g,{px:1,children:e(We,{name:"status",control:t.control,render:({field:I})=>e(he,{placement:"top",label:`${x("usersTable.status")}: `+(I.value!=="disabled"?x("active"):x("disabled")),textTransform:"capitalize",children:e(j,{mt:"6",children:e(je,{colorScheme:"primary",isChecked:I.value!=="disabled",onChange:J=>{J.target.checked?I.onChange("connecting"):I.onChange("disabled")}})})},I.value)})})]}),e(g,{alignItems:"flex-start",w:"100%",children:e(j,{w:"100%",children:e(qt,{label:x("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...t.register("address"),error:(u=(a=(c=t.formState)==null?void 0:c.errors)==null?void 0:a.address)==null?void 0:u.message})})}),r(g,{alignItems:"flex-start",w:"100%",children:[e(j,{children:e(qt,{label:x("nodes.nodePort"),size:"sm",placeholder:"62050",...t.register("port"),error:(P=(M=(S=t.formState)==null?void 0:S.errors)==null?void 0:M.port)==null?void 0:P.message})}),e(j,{children:e(qt,{label:x("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...t.register("api_port"),error:(z=(f=(k=t.formState)==null?void 0:k.errors)==null?void 0:f.api_port)==null?void 0:z.message})}),e(j,{children:e(qt,{label:x("nodes.usageCoefficient"),size:"sm",placeholder:"1",...t.register("usage_coefficient"),error:(X=(le=(O=t.formState)==null?void 0:O.errors)==null?void 0:le.usage_coefficient)==null?void 0:X.message})})]}),d&&e(D,{py:1,children:e(Lt,{...t.register("add_as_new_host"),children:e(U,{m:0,children:x("nodes.addHostForEveryInbound")})})}),r(g,{w:"full",children:[i,e(Z,{flexGrow:1,type:"submit",colorScheme:"primary",size:"sm",px:5,w:"full",isLoading:n,...l,children:o})]})]})})},ti=()=>{const{isEditingNodes:t,onEditingNodes:s}=$(),{t:n}=te(),[o,l]=b.exports.useState({}),{data:i,isLoading:d}=is(),x=()=>{l({}),s(!1)},y=R=>{o[String(R)]?delete o[String(R)]:o[String(R)]={},l({...o})};return r(Ge,{children:[r(ye,{isOpen:t,onClose:x,children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(Ce,{pt:6,children:e(ve,{color:"primary",children:e(Xl,{color:"white"})})}),e(ke,{mt:3}),r(_e,{w:"440px",pb:6,pt:3,children:[e(p,{mb:3,opacity:.8,fontSize:"sm",children:n("nodes.title")}),d&&"loading...",e(xt,{w:"full",allowToggle:!0,index:Object.keys(o).map(R=>parseInt(R)),children:r(H,{w:"full",children:[!d&&i&&i.map((R,w)=>e(Kl,{toggleAccordion:()=>y(w),node:R},R.name)),e(ei,{toggleAccordion:()=>y((i||[]).length),resetAccordions:()=>l({})})]})})]})]})]}),e(ql,{deleteCallback:()=>l({})})]})};function ri(t){const s=360/t,n=90,o=47,l=[];for(let i=0;i<t;i++){const d=i*s%360+140,x=ni(d,n,o);l.push(x)}return l}function ni(t,s,n){t/=360,s/=100,n/=100;let o,l,i;if(s===0)o=l=i=n;else{const x=(w,C,h)=>(h<0&&(h+=1),h>1&&(h-=1),h<.16666666666666666?w+(C-w)*6*h:h<.5?C:h<.6666666666666666?w+(C-w)*(.6666666666666666-h)*6:w),y=n<.5?n*(1+s):n+s-n*s,R=2*n-y;o=Math.round(x(R,y,t+1/3)*255),l=Math.round(x(R,y,t)*255),i=Math.round(x(R,y,t-1/3)*255)}const d=x=>{const y=x.toString(16);return y.length===1?"0"+y:y};return`#${d(o)}${d(l)}${d(i)}`}const dn=({border:t,...s})=>{const{getInputProps:n,getRadioProps:o}=ao(s),l=kt({base:"xs",md:"sm"});return r(j,{as:"label",children:[e("input",{...n()}),e(j,{...o(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:l,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:s.children})]})},gs=({onChange:t,defaultValue:s,...n})=>{const{t:o,i18n:l}=te();zt();const i=kt({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),d={h:"hour",d:"day",w:"week",m:"month",y:"year"},x=kt({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:y,getRadioProps:R,setValue:w}=lo({name:"filter",defaultValue:s,onChange:I=>{if(I==="custom")return;m(),i.indexOf(I)>=0?(c(o("userDialog.custom")),u(!1)):(c(o("userDialog.custom")+` (${I})`),u(!0));const J=Number(I.substring(0,I.length-1)),F=d[I[I.length-1]];t(I,{start:ue().utc().subtract(J,F).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:C,onOpen:h,onClose:m}=Pn(),_=b.exports.useRef(null);io({ref:_,handler:m});const[T,c]=b.exports.useState(o("userDialog.custom")),[a,u]=b.exports.useState(!1),[S,M]=b.exports.useState(0),P=kt({base:1,md:2}),k=kt({base:"xs",md:"sm"}),[f,z]=b.exports.useState(null),[O,le]=b.exports.useState(null),X=I=>{const[J,F]=I;O&&!F?(z(null),le(null)):(z(J),le(F),J&&F&&(m(),t("custom",{start:ue(J).format("YYYY-MM-DDT00:00:00"),end:ue(F).format("YYYY-MM-DDT23:59:59")})))};return r(H,{...n,children:[S==0&&r(vt,{...y(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[i.map(I=>e(dn,{...R({value:I}),children:I},I)),e(j,{onClick:()=>{z(null),le(null),h()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:k,px:3,py:1,bg:a?"primary.500":"unset",color:a?"white":"unset",borderColor:a?"primary.500":"unset",children:r(g,{children:[e(p,{children:T}),e(xr,{as:en,boxSize:"18px"})]})})]}),S==1&&r(g,{onClick:h,cursor:"pointer",fontSize:k,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(p,{w:"full",color:f?"unset":"gray.500",children:f?ue(f).format("YYYY-MM-DD (00:00)"):o("userDialog.startDate")}),e(xr,{as:Fn,boxSize:"18px"}),e(p,{w:"full",color:O?"unset":"gray.500",children:O?ue(O).format("YYYY-MM-DD (23:59)"):o("userDialog.endDate")}),e(xr,{as:en,boxSize:"18px"})]}),e(H,{ref:_,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:C?"unset":"none",children:r(Nn,{onChange:I=>M(I),children:[r(Mn,{children:[e(St,{fontSize:k,children:o("userDialog.relative")}),e(St,{fontSize:k,children:o("userDialog.absolute")})]}),r(On,{children:[e(wt,{children:x.map(I=>e(H,{alignItems:"start",pl:2,pr:2,children:r(g,{justifyItems:"flex-start",mb:4,children:[e(p,{fontSize:k,minW:"60px",children:o("userDialog."+I.title)}),I.options.map(J=>e(dn,{border:!0,...R({value:J}),children:J},J+".custom"))]})},I.title))}),e(wt,{className:"datepicker-panel",children:e(H,{children:e(Wn,{locale:l.language.toLocaleLowerCase(),selected:f,onChange:X,startDate:f,endDate:O,selectsRange:!0,maxDate:new Date,monthsShown:P,peekNextMonth:!1,inline:!0})})})]})]})})]})};function cr(t,s,n=[],o=[]){const l=Oe(n.reduce((i,d)=>i+=d,0));return{series:n,options:{labels:o,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${s}${l}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(i,{seriesIndex:d,w:x})=>Oe(x.config.series[d],1)},tooltip:{custom:({series:i,seriesIndex:d,dataPointIndex:x,w:y})=>{const R=Oe(i[d],1),w=Math.max(i.reduce((h,m)=>h+=m),1),C=Math.round(i[d]/w*1e3)/10+"%";return`
            <div style="
                    background-color: ${y.globals.colors[d]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${y.config.labels[d]}: <b>${C}, ${R}</b>
            </div>
          `}},colors:ri(n.length)}}}const hn=(t,s=[],n=[])=>({series:s,options:{chart:{type:"bar",stacked:!0,width:"100%",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!0,borderRadius:6,dataLabels:{total:{enabled:!0,offsetX:20,style:{fontSize:"var(--chakra-fontSizes-xs)",fontWeight:900,color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}}}}},stroke:{width:1,colors:["#fff"]},dataLabels:{formatter:(o,{seriesIndex:l,w:i})=>Oe(o,1)},xaxis:{type:"category",categories:n,labels:{formatter:function(o){return Oe(o,0)},style:{colors:t==="dark"?"var(--chakra-colors-gray-300)":void 0}}},yaxis:{title:{text:void 0},labels:{style:{fontSize:"var(--chakra-fontSizes-sm)",colors:t==="dark"?"var(--chakra-colors-gray-300)":void 0}}},tooltip:{custom:({series:o,seriesIndex:l,dataPointIndex:i,w:d})=>{console.log(o);const x=o[l],y=Oe(x[i],1);return`
            <div style="
                    background-color: ${d.globals.colors[l]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${d.globals.seriesNames[l]}: <b>${y}</b>
            </div>
          `}},fill:{opacity:1},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}}}}),si=E(hr,{baseStyle:{w:5,h:5}}),oi=()=>{const{isShowingNodesUsage:t,onShowingNodesUsage:s,fetchUserUsageTop10:n}=$(),{fetchNodesUsage:o}=tr(),{t:l}=te(),[i,d]=b.exports.useState(!1),{colorMode:x}=zt(),y=l("userDialog.total"),[R,w]=b.exports.useState(cr(x,y)),[C,h]=b.exports.useState(hn(x)),[m,_]=b.exports.useState("1m"),T=u=>{o(u).then(S=>{const M=[],P=[];for(const k in S.usages){const f=S.usages[k];P.push(f.uplink+f.downlink),M.push(f.node_name)}w(cr(x,y,P,M))}),n(u).then(S=>{const M=S.usages,P=S.users;h(hn(x,M,P))})};b.exports.useEffect(()=>{t&&T({start:ue().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})},[t]);const c=()=>{s(!1),_("1m")},a=i;return r(ye,{isOpen:t,onClose:c,size:"2xl",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",w:"full",children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:e(si,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:l("header.nodesUsage")})]})}),e(ke,{mt:3,disabled:a}),e(_e,{children:r(H,{gap:4,children:[e(gs,{defaultValue:m,onChange:(u,S)=>{_(u),T(S)}}),e(j,{justifySelf:"center",w:"full",mt:"4",children:e(b.exports.Suspense,{fallback:e(Ir,{isIndeterminate:!0}),children:e(Er,{options:R.options,series:R.series,type:"donut",height:"360px"})})}),e(j,{justifySelf:"center",w:"full",children:e(b.exports.Suspense,{fallback:e(Ir,{isIndeterminate:!0}),children:e(Er,{options:C.options,series:C.series,type:"bar"})})})]})}),e(Fe,{mt:"3"})]})]})},un=E(co),li=E(Fn,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),ii=E(ho,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),ai=E(Hr,{baseStyle:{w:5,h:5}}),ci=()=>{const{QRcodeLinks:t,setQRCode:s,setSubLink:n,subscribeUrl:o}=$(),l=t!==null,[i,d]=b.exports.useState(0),{t:x}=te(),y=()=>{s(null),n(null)},R=String(o).startsWith("/")?window.location.origin+o:String(o);return r(ye,{isOpen:l,onClose:y,children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(Ce,{pt:6,children:e(ve,{color:"primary",children:e(ai,{color:"white"})})}),e(ke,{mt:3}),t&&r(_e,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[o&&r(H,{children:[e(un,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:R,bg:"white"}),e(p,{display:"block",textAlign:"center",pb:3,mt:1,children:x("qrcodeDialog.sublink")})]}),r(j,{w:"300px",children:[e(uo,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:d,onInit:()=>d(0),nextArrow:e(Y,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(li,{})}),prevArrow:e(Y,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(ii,{})}),children:t.map((w,C)=>e(g,{children:e(un,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:w,bg:"white"})},C))}),r(p,{display:"block",textAlign:"center",pb:3,mt:1,children:[i+1," / ",t.length]})]})]})]})]})},di=E(En,{baseStyle:{w:5,h:5}}),hi=()=>{const[t,s]=b.exports.useState(!1),{isResetingAllUsage:n,onResetAllUsage:o,resetAllUsage:l}=$(),{t:i}=te(),d=Pe(),x=()=>{o(!1)},y=()=>{s(!0),l().then(()=>{d({title:i("resetAllUsage.success"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{d({title:i("resetAllUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)})};return r(ye,{isCentered:!0,isOpen:n,onClose:x,size:"sm",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",children:[e(Ce,{pt:6,children:e(ve,{color:"red",children:e(di,{})})}),e(ke,{mt:3}),r(_e,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:i("resetAllUsage.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:i("resetAllUsage.prompt")})]}),r(Fe,{display:"flex",children:[e(Z,{size:"sm",onClick:x,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(Z,{size:"sm",w:"full",colorScheme:"red",onClick:y,leftIcon:t?e(De,{size:"xs"}):void 0,children:i("reset")})]})]})]})},ui=E(Kt,{baseStyle:{w:5,h:5}}),pi=()=>{const[t,s]=b.exports.useState(!1),{resetUsageUser:n,resetDataUsage:o}=$(),{t:l}=te(),i=Pe(),d=()=>{$.setState({resetUsageUser:null})},x=()=>{n&&(s(!0),o(n).then(()=>{i({title:l("resetUserUsage.success",{username:n.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:l("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return r(ye,{isCentered:!0,isOpen:!!n,onClose:d,size:"sm",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",children:[e(Ce,{pt:6,children:e(ve,{color:"blue",children:e(ui,{})})}),e(ke,{mt:3}),r(_e,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:l("resetUserUsage.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(dt,{components:{b:e("b",{})},children:l("resetUserUsage.prompt",{username:n.username})})})]}),r(Fe,{display:"flex",children:[e(Z,{size:"sm",onClick:d,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Z,{size:"sm",w:"full",colorScheme:"blue",onClick:x,leftIcon:t?e(De,{size:"xs"}):void 0,children:l("reset")})]})]})]})},mi=E(Kt,{baseStyle:{w:5,h:5}}),gi=()=>{const[t,s]=b.exports.useState(!1),{revokeSubscriptionUser:n,revokeSubscription:o}=$(),{t:l}=te(),i=Pe(),d=()=>{$.setState({revokeSubscriptionUser:null})},x=()=>{n&&(s(!0),o(n).then(()=>{i({title:l("revokeUserSub.success",{username:n.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:l("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return r(ye,{isCentered:!0,isOpen:!!n,onClose:d,size:"sm",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",children:[e(Ce,{pt:6,children:e(ve,{color:"blue",children:e(mi,{})})}),e(ke,{mt:3}),r(_e,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:l("revokeUserSub.title")}),n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(dt,{components:{b:e("b",{})},children:l("revokeUserSub.prompt",{username:n.username})})})]}),r(Fe,{display:"flex",children:[e(Z,{size:"sm",onClick:d,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Z,{size:"sm",w:"full",colorScheme:"blue",onClick:x,leftIcon:t?e(De,{size:"xs"}):void 0,children:l("revoke")})]})]})]})},fi=t=>b.exports.createElement("svg",{height:60,width:60,viewBox:"0 0 60 60",xmlns:"http://www.w3.org/2000/svg",...t},b.exports.createElement("path",{fill:"#ccc",d:"M30 60a30 30 0 1130-30 30 30 0 01-30 30zm14-34H34V16a4 4 0 00-8 0v10H16a4 4 0 000 8h10v10a4 4 0 008 0V34h10a4 4 0 000-8z"})),pe=Jt((t,s)=>({loading:!1,sublink:null,setSublink:n=>t({sublink:n}),settings:[],editingSetting:null,onEditingSetting:n=>t({editingSetting:n}),fetchSettings:async()=>{t({loading:!0});try{const n=await B("/clash/settings");return t({settings:n.data}),n.data}finally{t({loading:!1})}},editSetting:async n=>{await B(`/clash/setting/${n.name}`,{method:"PUT",body:n}),t({editingSetting:null}),s().fetchSettings()},alert:null,onAlert:n=>t({alert:n}),rules:[],totalRules:0,rulesets:[],ruleFilter:{value:"",sort:"-modified_at",limit:10},fetchRules:async()=>{const n=s().ruleFilter;for(const o in n)n[o]||delete n[o];t({loading:!0});try{const o=await B("/clash/rules",{query:n});return t({rules:o.data,totalRules:o.total}),o.data}finally{t({loading:!1})}},fetchRulesets:async()=>{const n=await B("/clash/rulesets");return pe.setState({rulesets:n.data}),n.data},onRuleFilterChange:n=>{t({ruleFilter:{...s().ruleFilter,...n}}),s().fetchRules()},isCreatingRule:!1,editingRule:null,onCreateRule:n=>t({isCreatingRule:n}),onEditingRule:n=>t({editingRule:n}),createRule:async n=>{await B("/clash/rule",{method:"POST",body:n}),t({editingRule:null}),s().fetchRules()},editRule:async n=>{await B(`/clash/rule/${n.id}`,{method:"PUT",body:n}),t({editingRule:null}),s().fetchRules()},deleteRule:async n=>{await B(`/clash/rule/${n.id}`,{method:"DELETE"}),t({editingRule:null}),s().fetchRules()},isCreatingRuleset:!1,editingRuleset:null,onCreateRuleset:n=>t({isCreatingRuleset:n}),onEditingRuleset:n=>t({editingRuleset:n}),createRuleset:async n=>{await B("/clash/ruleset",{method:"POST",body:n}),t({editingRuleset:null}),s().fetchRulesets()},editRuleset:async n=>{await B(`/clash/ruleset/${n.id}`,{method:"PUT",body:n}),t({editingRuleset:null}),s().fetchRulesets()},deleteRuleset:async n=>{await B(`/clash/ruleset/${n.id}`,{method:"DELETE"}),t({editingRuleset:null}),s().ruleFilter.ruleset="",s().fetchRulesets(),s().fetchRules()},proxyTags:[],proxyInbounds:[],proxyBriefs:[],proxies:[],totalProxies:0,proxyFilter:{search:"",sort:"id",limit:10},fetchProxies:async()=>{const n=s().proxyFilter;for(const o in n)n[o]||delete n[o];t({loading:!0});try{const o=await B("/clash/proxies",{query:n});return t({proxies:o.data,totalProxies:o.total}),o.data}finally{t({loading:!1})}},fetchProxyTags:async()=>{const n=await B("/clash/proxy/tags");return t({proxyTags:n.data}),n.data},fetchProxyInbounds:async()=>{const n=await B("/clash/proxy/inbounds");return t({proxyInbounds:n.data}),n.data},fetchProxyBriefs:async()=>{const n=await B("/clash/proxy/briefs");return t({proxyBriefs:n.data}),n.data},onProxyFilterChange:n=>{t({proxyFilter:{...s().proxyFilter,...n}}),s().fetchProxies()},isCreatingProxy:!1,editingProxy:null,duplicatingProxy:null,onCreateProxy:n=>t({isCreatingProxy:n}),onEditingProxy:n=>t({editingProxy:n}),onDuplicatingProxy:n=>{n?(s().onEditingProxy(null),t({duplicatingProxy:n}),s().onCreateProxy(!0)):t({duplicatingProxy:n})},createProxy:async n=>{await B("/clash/proxy",{method:"POST",body:n}),t({editingProxy:null}),s().fetchProxyBriefs(),s().fetchProxyTags(),s().fetchProxies()},editProxy:async n=>{await B(`/clash/proxy/${n.id}`,{method:"PUT",body:n}),$.getState().refetchUsers(),t({editingProxy:null}),s().fetchProxyBriefs(),s().fetchProxyTags(),s().fetchProxies()},deleteProxy:async n=>{await B(`/clash/proxy/${n.id}`,{method:"DELETE"}),t({editingProxy:null}),$.getState().refetchUsers(),s().fetchProxyBriefs(),s().fetchProxyTags(),s().fetchProxies()},proxyGroups:[],totalProxyGroups:0,proxyGroupFilter:{search:"",sort:"id",limit:10},fetchProxyGroups:async()=>{const n=s().proxyGroupFilter;for(const o in n)n[o]||delete n[o];t({loading:!0});try{const o=await B("/clash/proxy/groups",{query:n});return t({proxyGroups:o.data,totalProxyGroups:o.total}),o.data}finally{t({loading:!1})}},onProxyGroupFilterChange:n=>{t({proxyGroupFilter:{...s().proxyGroupFilter,...n}}),s().fetchProxyGroups()},isCreatingProxyGroup:!1,editingProxyGroup:null,duplicatingProxyGroup:null,onCreateProxyGroup:n=>t({isCreatingProxyGroup:n}),onEditingProxyGroup:n=>t({editingProxyGroup:n}),onDuplicatingProxyGroup:n=>{n?(s().onEditingProxyGroup(null),t({duplicatingProxyGroup:n}),s().onCreateProxyGroup(!0)):t({duplicatingProxyGroup:n})},createProxyGroup:async n=>{await B("/clash/proxy/group",{method:"POST",body:n}),t({editingProxyGroup:null}),s().fetchProxyTags(),s().fetchProxyGroups(),s().fetchProxyBriefs()},editProxyGroup:async n=>{await B(`/clash/proxy/group/${n.id}`,{method:"PUT",body:n}),$.getState().refetchUsers(),t({editingProxyGroup:null}),s().fetchProxyTags(),s().fetchProxyGroups(),s().fetchProxyBriefs()},deleteProxyGroup:async n=>{await B(`/clash/proxy/group/${n.id}`,{method:"DELETE"});const o=s().editingProxyGroup;o!=null&&o.tag&&$.getState().refetchUsers(),t({editingProxyGroup:null}),s().fetchProxyTags(),s().fetchProxyGroups(),s().fetchProxyBriefs()},links:[],totalLinks:0,linkFilter:{search:"",sort:"id",limit:10},fetchLinks:async()=>{const n=s().linkFilter;for(const o in n)n[o]||delete n[o];t({loading:!0});try{const o=await B("/clash/links",{query:n}),i={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},d=o.data.map(x=>({...x,modified_at:new Date(x.modified_at+"Z").toLocaleString("zh-CN",i)}));return t({links:d,totalLinks:o.total}),o.data}finally{t({loading:!1})}},onLinkFilterChange:n=>{t({linkFilter:{...s().linkFilter,...n}}),s().fetchLinks()},isCreatingLink:!1,editingLink:null,onCreateLink:n=>t({isCreatingLink:n}),onEditingLink:n=>t({editingLink:n}),createLink:async n=>{await B("/clash/link",{method:"POST",body:n}),t({editingLink:null}),s().fetchLinks(),s().fetchProxyTags()},editLink:async n=>{await B(`/clash/link/${n.id}`,{method:"PUT",body:n}),t({editingLink:null}),s().fetchLinks(),s().fetchProxyTags(),$.getState().refetchUsers()},deleteLink:async n=>{await B(`/clash/link/${n.id}`,{method:"DELETE"}),t({editingLink:null}),s().fetchLinks(),s().fetchProxyTags(),$.getState().refetchUsers()}})),bi=E(po,{baseStyle:{strokeWidth:"2px",w:5,h:5}}),xi=({inbound:t,...s})=>{const{getCheckboxProps:n,getInputProps:o,getLabelProps:l,htmlProps:i}=jn(s),d=o();return r(j,{as:"label",children:[e("input",{...d}),r(j,{w:"fll",position:"relative",...i,cursor:"pointer",borderRadius:"sm",border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"gray.600"},display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden",_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent",fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& p":{opacity:1}},__css:{"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...n(),children:[e(Lt,{size:"sm",w:"full",maxW:"full",color:"gray.700",_dark:{color:"gray.300"},textTransform:"uppercase",colorScheme:"primary",className:"inbound-item",isChecked:d.checked,pointerEvents:"none",flexGrow:1,children:e(g,{justify:"space-between",w:"full",maxW:"calc(100% - 20px)",spacing:0,gap:2,overflow:"hidden",children:r(p,{isTruncated:!0,...l(),fontSize:"xs",children:[t.tag," ",r(p,{as:"span",children:["(",t.network,")"]})]})})}),t.tls&&t.tls!="none"&&e(re,{fontSize:"xs",opacity:".8",size:"xs",children:t.tls})]})]})},yi=({disabled:t,title:s,description:n,toggleAccordion:o,isSelected:l,...i})=>{const d=jr(),{inbounds:x}=$(),{getCheckboxProps:y,getInputProps:R,getLabelProps:w,htmlProps:C}=jn(i),h=R(),[m]=Bn({name:[`inbounds.${s}`],control:d.control}),{getCheckboxProps:_}=$n({value:m,onChange:u=>{if(d.setValue(`inbounds.${s}`,u),u.length===0){const S=d.getValues("selected_proxies");d.setValue("selected_proxies",S.filter(M=>M!==s)),o()}}}),T=m&&l&&($.getState().inbounds.get(s)||[]).length!==m.length,c=($.getState().inbounds.get(s)||[]).length>0,a=!l&&!c;return r(ut,{isDisabled:!c,borderRadius:"md",borderStyle:"solid",border:"1px",borderColor:"gray.200",bg:a?"gray.100":"transparent",_dark:{borderColor:"gray.600",bg:a?"#364154":"transparent"},_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent"},...y(),children:[r(j,{as:a?"span":"label",position:"relative",children:[T&&e(j,{position:"absolute",w:"2",h:"2",bg:"yellow.500",top:"-1",right:"-1",rounded:"full",zIndex:999}),e("input",{...h}),r(j,{w:"fll",position:"relative",...C,borderRadius:"md",cursor:a?"not-allowed":"pointer",_checked:{fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& > svg":{opacity:1,"&.checked":{display:"block"},"&.unchecked":{display:"none"}},"& p":{opacity:1}},__css:{"& > svg":{opacity:.3,"&.checked":{display:"none"},"&.unchecked":{display:"block"}},"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...y(),children:[e(pt,{display:h.checked&&c?"block":"none",as:"span",className:"checked",color:"primary.200",position:"absolute",right:"3",top:"3",w:"auto",p:0,onClick:o,children:e(Y,{size:"sm","aria-label":"inbound settings",children:e(bi,{})})}),e(p,{fontSize:"sm",color:a?"gray.400":"gray.700",_dark:{color:a?"gray.500":"gray.300"},...w(),children:s}),e(p,{fontWeight:"medium",color:a?"gray.400":"gray.600",_dark:{color:a?"gray.500":"gray.400"},fontSize:"xs",children:n})]})]}),e(mt,{px:2,pb:3,roundedBottom:"5px",pt:3,_dark:{bg:h.checked&&"gray.750"},children:r(H,{w:"full",rowGap:2,borderStyle:"solid",borderWidth:"1px",borderRadius:"md",pl:3,pr:3,pt:1.5,_dark:{bg:"gray.700"},children:[r(H,{alignItems:"flex-start",w:"full",children:[e(p,{fontSize:"sm",children:Re("inbound")}),e(vt,{gap:2,alignItems:"flex-start",w:"full",columns:1,spacing:1,children:(x.get(s)||[]).map(u=>e(xi,{..._({value:u.tag}),inbound:u},u.tag))})]}),s==="vmess"&&l&&e(H,{alignItems:"flex-start",w:"full",children:r(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:"ID"}),e(q,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Re("userDialog.generatedByDefault"),...d.register("proxies.vmess.id")})]})}),s==="vless"&&l&&r(H,{alignItems:"flex-start",w:"full",children:[r(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:"ID"}),e(q,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Re("userDialog.generatedByDefault"),...d.register("proxies.vless.id")})]}),r(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:"Flow"}),e(me,{fontSize:"xs",size:"sm",borderRadius:"6px",...d.register("proxies.vless.flow"),children:Fl.map(u=>e("option",{value:u.value,children:u.title},u.title))})]})]}),s==="trojan"&&l&&e(H,{alignItems:"flex-start",w:"full",children:r(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:Re("password")}),e(q,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Re("userDialog.generatedByDefault"),...d.register("proxies.trojan.password")})]})}),s==="shadowsocks"&&l&&r(H,{alignItems:"flex-start",w:"full",children:[r(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:Re("password")}),e(q,{fontSize:"xs",size:"sm",borderRadius:"6px",pl:2,pr:2,placeholder:Re("userDialog.generatedByDefault"),...d.register("proxies.shadowsocks.password")})]}),r(D,{height:"66px",children:[e(p,{fontSize:"sm",pb:1,children:Re("userDialog.method")}),e(me,{fontSize:"xs",size:"sm",borderRadius:"6px",...d.register("proxies.shadowsocks.method"),children:Nl.map(u=>e("option",{value:u,children:u},u))})]})]})]})})]})},Si=b.exports.forwardRef(({name:t,list:s,onChange:n,disabled:o,...l},i)=>{const d=jr(),[x,y]=b.exports.useState([]),R=C=>{x.includes(C)?x.splice(x.indexOf(C),1):x.push(C),y([...x])},{getCheckboxProps:w}=$n({value:l.value,onChange:C=>{var m;const h=C.filter(_=>!l.value.includes(_));h[0]&&d.setValue(`inbounds.${h[0]}`,(m=$.getState().inbounds.get(h[0]))==null?void 0:m.map(_=>_.tag)),y(x.filter(_=>C.find(T=>T===s[_].title))),n(C)}});return e(xt,{allowToggle:!0,index:x,children:e(vt,{ref:i,gap:2,alignItems:"flex-start",columns:1,spacing:1,children:s.map((C,h)=>e(yi,{toggleAccordion:R.bind(null,h),disabled:o,title:C.title,description:C.description,isSelected:!!l.value.find(m=>m===C.title),...w({value:C.title})},C.title))})})}),nr={baseStyle:{w:5,h:5}},wi=E(Wr,nr),Ci=E(Or,nr),ki=E(pr,nr),_i=E(er,nr),vi=E(Mr,nr),zi=E(fi),Ii=E($r,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Ri=E(mo,{baseStyle:{w:5,h:5}}),Di=E(Ot,{baseStyle:{w:5,h:5}}),Ei=E(hr,{baseStyle:{w:5,h:5}}),Ti=t=>({...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,selected_proxies:Object.keys(t.proxies),sub_tags:t.sub_tags||""}),wr=()=>{const t=Object.fromEntries($.getState().inbounds),s={};for(const n in t)s[n]=t[n].map(o=>o.tag);return{selected_proxies:Object.keys(t),data_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:s,proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},sub_url_prefix:"",sub_tags:"",sub_revoked_at:""}},Li=(t,s)=>{const n=t.reduce((o,l)=>({...o,[l]:{}}),{});return s&&t.forEach(o=>{s[o]&&(n[o]=s[o])}),n},Yt={username:v.string().min(1,{message:"Required"}),selected_proxies:v.array(v.string()).refine(t=>t.length>0,{message:"userDialog.selectOneProtocol"}),note:v.string().nullable(),proxies:v.record(v.string(),v.record(v.string(),v.any())).transform(t=>{const s=(n,o)=>{n&&n[o]===""&&delete n[o]};return s(t.vmess,"id"),s(t.vless,"id"),s(t.trojan,"password"),s(t.shadowsocks,"password"),s(t.shadowsocks,"method"),t}),data_limit:v.string().min(0).or(v.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:v.number().nullable(),data_limit_reset_strategy:v.string(),sub_url_prefix:v.string().nullable(),sub_tags:v.string().nullable(),inbounds:v.record(v.string(),v.array(v.string())).transform(t=>(Object.keys(t).forEach(s=>{var n;Array.isArray(t[s])&&!((n=t[s])!=null&&n.length)&&delete t[s]}),t))},Ui=v.discriminatedUnion("status",[v.object({status:v.literal("active"),...Yt}),v.object({status:v.literal("disabled"),...Yt}),v.object({status:v.literal("limited"),...Yt}),v.object({status:v.literal("expired"),...Yt}),v.object({status:v.literal("on_hold"),on_hold_expire_duration:v.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...Yt})]),Ai=()=>{var Ye,Ze,Qe,Ee,xe;const{editingUser:t,isCreatingNewUser:s,onCreateUser:n,editUser:o,fetchUserUsage:l,onEditingUser:i,createUser:d,onDeletingUser:x}=$(),y=!!t,R=s||y,[w,C]=b.exports.useState(!1),[h,m]=b.exports.useState(""),[_,T]=b.exports.useState("hidden"),[c,a]=b.exports.useState(""),u=Pe(),{t:S,i18n:M}=te(),{colorMode:P}=zt(),[k,f]=b.exports.useState(!1),z=()=>{f(A=>!A)},{isOpen:O,onToggle:le,onClose:X}=Pn(),I=Ke({defaultValues:wr(),resolver:ft(Ui)});b.exports.useEffect(()=>$.subscribe(A=>A.inbounds,()=>{I.reset(wr())}),[]);const[J,F]=Bn({control:I.control,name:["data_limit","status"]}),W=S("userDialog.total"),[G,ne]=b.exports.useState(cr(P,W)),[ce,K]=b.exports.useState("1m"),fe=A=>{l(t,A).then(oe=>{const Ne=[],Ve=[];for(const tt in oe.usages)Ve.push(oe.usages[tt].used_traffic),Ne.push(oe.usages[tt].node_name);ne(cr(P,W,Ve,Ne))})};b.exports.useEffect(()=>{t&&(I.reset(Ti(t)),a(t.sub_url_prefix),fe({start:ue().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}))},[t]);const N=A=>{C(!0);const oe={edited:o,created:d},Ne=y?"edited":"created";m(null);const{selected_proxies:Ve,...tt}=A;let lt={...tt,data_limit:A.data_limit,proxies:Li(Ve,A.proxies),data_limit_reset_strategy:A.data_limit&&A.data_limit>0?A.data_limit_reset_strategy:"no_reset",status:A.status==="active"||A.status==="disabled"||A.status==="on_hold"?A.status:"active"};oe[Ne](lt).then(()=>{u({title:S(y?"userDialog.userEdited":"userDialog.userCreated",{username:A.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),L()}).catch(be=>{var $t,jt,Bt,Ht,Vt;((($t=be==null?void 0:be.response)==null?void 0:$t.status)===409||((jt=be==null?void 0:be.response)==null?void 0:jt.status)===400)&&m((Ht=(Bt=be==null?void 0:be.response)==null?void 0:Bt._data)==null?void 0:Ht.detail),((Vt=be==null?void 0:be.response)==null?void 0:Vt.status)===422&&Object.keys(be.response._data.detail).forEach(Dt=>{m(be==null?void 0:be.response._data.detail[Dt]),I.setError(Dt,{type:"custom",message:be.response._data.detail[Dt]})})}).finally(()=>{C(!1)})},L=()=>{I.reset(wr()),n(!1),i(null),m(null),f(!1),K("1m"),X()},ee=()=>{$.setState({resetUsageUser:t})},V=()=>{$.setState({revokeSubscriptionUser:t})},ie=w,Q=F==="on_hold",[se,Ie]=b.exports.useState(!1),He=()=>{Ie(!0);let A="";const oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Ne=oe.length;let Ve=0;for(;Ve<6;)A+=oe.charAt(Math.floor(Math.random()*Ne)),Ve+=1;return A};return r(ye,{isOpen:R,onClose:L,size:"2xl",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Rt,{...I,children:e(we,{mx:"3",children:r("form",{onSubmit:I.handleSubmit(N),children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:y?e(Di,{color:"white"}):e(Ri,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:S(y?"userDialog.editUserTitle":"createNewUser")})]})}),e(ke,{mt:3,disabled:ie}),r(_e,{children:[r(vn,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:[e(Tt,{children:r(H,{justifyContent:"space-between",children:[r(Ct,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[r(Ct,{flexDirection:"row",w:"full",gap:2,children:[r(D,{mb:"10px",children:[e(U,{children:r(Ct,{gap:2,alignItems:"center",children:[S("username"),!y&&e(Gr,{cursor:"pointer",className:qe({"animate-spin":se}),onClick:()=>{const A=He();I.setValue("username",A),setTimeout(()=>{Ie(!1)},350)}})]})}),r(g,{children:[e(rt,{size:"sm",type:"text",borderRadius:"6px",error:(Ye=I.formState.errors.username)==null?void 0:Ye.message,disabled:ie||y,...I.register("username")}),y&&e(g,{px:1,children:e(We,{name:"status",control:I.control,render:({field:A})=>e(he,{placement:"top",label:"status: "+S(`status.${A.value}`),textTransform:"capitalize",children:e(j,{children:e(je,{colorScheme:"primary",isChecked:A.value==="active",onChange:oe=>{oe.target.checked?A.onChange("active"):A.onChange("disabled")}})})})})})]})]}),!y&&r(D,{flex:"1",children:[e(U,{whiteSpace:"nowrap",children:S("userDialog.onHold")}),e(We,{name:"status",control:I.control,render:({field:A})=>{const oe=A.value;return e(Ge,{children:oe?e(je,{colorScheme:"primary",isChecked:oe==="on_hold",onChange:Ne=>{Ne.target.checked?A.onChange("on_hold"):A.onChange("active")}}):""})}})]})]}),r(D,{mb:"10px",children:[e(U,{children:S("userDialog.dataLimit")}),e(We,{control:I.control,name:"data_limit",render:({field:A})=>{var oe;return e(rt,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:A.onChange,disabled:ie,error:(oe=I.formState.errors.data_limit)==null?void 0:oe.message,value:A.value?String(A.value):""})}})]}),e(Dr,{in:!!(J&&J>0),animateOpacity:!0,style:{width:"100%"},children:r(D,{height:"66px",children:[e(U,{children:S("userDialog.periodicUsageReset")}),e(We,{control:I.control,name:"data_limit_reset_strategy",render:({field:A})=>e(me,{size:"sm",...A,disabled:ie,bg:ie?"gray.100":"transparent",_dark:{bg:ie?"gray.600":"transparent"},sx:{option:{backgroundColor:P==="dark"?"#222C3B":"white"}},children:Ur.map(oe=>e("option",{value:oe.value,children:S("userDialog.resetStrategy"+oe.title)},oe.value))})})]})}),r(D,{mb:"10px",children:[e(U,{children:S(Q?"userDialog.onHoldExpireDuration":"userDialog.expiryDate")}),Q&&e(We,{control:I.control,name:"on_hold_expire_duration",render:({field:A})=>{var oe;return e(rt,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Ne=>{I.setValue("expire",null),A.onChange({target:{value:Ne}})},disabled:ie,error:(oe=I.formState.errors.on_hold_expire_duration)==null?void 0:oe.message,value:A.value?String(A.value):""})}}),!Q&&e(We,{name:"expire",control:I.control,render:({field:A})=>{var tt;function oe(lt){return ue(ue(lt*1e3).utc()).toDate()}const{status:Ne,time:Ve}=gr(A.value);return r(Ge,{children:[e(Wn,{locale:M.language.toLocaleLowerCase(),dateFormat:S("dateFormat"),minDate:new Date,selected:A.value?oe(A.value):void 0,onChange:lt=>{I.setValue("on_hold_expire_duration",null),A.onChange({target:{value:lt?ue(ue(lt).set("hour",23).set("minute",59).set("second",59)).utc().valueOf()/1e3:0,name:"expire"}})},customInput:e(rt,{size:"sm",type:"text",borderRadius:"6px",clearable:!0,disabled:ie,error:(tt=I.formState.errors.expire)==null?void 0:tt.message})}),A.value?e(Hn,{children:S(Ne,{time:Ve})}):""]})}})]}),r(D,{mb:"10px",isInvalid:!!I.formState.errors.note,children:[e(U,{children:S("userDialog.note")}),e(go,{...I.register("note")}),e(ze,{children:(Qe=(Ze=I.formState.errors)==null?void 0:Ze.note)==null?void 0:Qe.message})]})]}),h&&r(st,{status:"error",display:{base:"none",md:"flex"},children:[e(gt,{}),h]})]})}),e(Tt,{children:r(D,{isInvalid:!!((Ee=I.formState.errors.selected_proxies)!=null&&Ee.message),children:[e(U,{children:S("userDialog.protocols")}),e(We,{control:I.control,name:"selected_proxies",render:({field:A})=>e(Si,{list:[{title:"vmess",description:S("userDialog.vmessDesc")},{title:"vless",description:S("userDialog.vlessDesc")},{title:"trojan",description:S("userDialog.trojanDesc")},{title:"shadowsocks",description:S("userDialog.shadowsocksDesc")}],disabled:ie,...A})}),e(ze,{children:S((xe=I.formState.errors.selected_proxies)==null?void 0:xe.message)})]})}),e(Tt,{colSpan:{base:1,md:2},children:e(Dr,{in:O,style:{overflow:_},onAnimationComplete:()=>T("unset"),animateOpacity:!0,children:r(vt,{columns:{base:1,md:2},spacing:3,children:[r(Ct,{pt:"15px",flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[r(D,{mb:"10px",children:[e(U,{children:S("userDialog.issuedAt")}),e(We,{name:"sub_revoked_at",control:I.control,render:({field:A})=>e(g,{children:e(q,{size:"sm",borderRadius:"6px",disabled:!0,value:ue.utc(A.value).local().format("YYYY-MM-DD HH:mm:ss")})})})]}),r(D,{mb:"10px",isInvalid:!!I.formState.errors.sub_url_prefix,children:[e(U,{children:S("userDialog.urlPrefix")}),e(rt,{size:"sm",type:"text",borderRadius:"6px",placeholder:"Domain (e.g. https://example.com)",disabled:ie,...I.register("sub_url_prefix",{onChange:A=>a(A.target.value)})}),c&&r(p,{maxW:"300px",pt:"1",fontSize:"xs",color:"gray.500",w:"inherit",noOfLines:1,children:[c,"/sub/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"]})]})]}),e(Ct,{pt:"15px",flexDirection:"column",gridAutoRows:"min-content",w:"full",children:r(D,{mb:"10px",isInvalid:!!I.formState.errors.sub_url_prefix,children:[r(g,{mb:"1",children:[e(U,{mr:"0",mb:"0",children:S("clash.tag")}),r(Te,{isLazy:!0,placement:"top",children:[e(Le,{children:e(Ii,{})}),r(Ue,{w:"300px",children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:S("userDialog.tags.info")})]})]})]}),e(We,{name:"sub_tags",control:I.control,render:({field:A})=>e(Pi,{tags:A.value,onChange:A.onChange})})]})})]})})}),y&&k&&e(Tt,{pt:6,colSpan:{base:1,md:2},children:r(H,{gap:4,children:[e(gs,{defaultValue:ce,onChange:(A,oe)=>{K(A),fe(oe)}}),e(j,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(Er,{options:G.options,series:G.series,type:"donut"})})]})})]}),h&&r(st,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(gt,{}),h]})]}),e(Fe,{mt:"3",children:r(g,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(g,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:y&&r(Ge,{children:[e(he,{label:S("delete"),placement:"top",children:e(Y,{"aria-label":"Delete",size:"sm",onClick:()=>{x(t),L()},children:e(ot,{})})}),e(he,{label:S("userDialog.subscription"),placement:"top",children:e(Y,{"aria-label":"usage",size:"sm",onClick:()=>{T("hidden"),le()},children:e(wi,{})})}),e(he,{label:S("userDialog.usage"),placement:"top",children:e(Y,{"aria-label":"usage",size:"sm",onClick:z,children:e(Ei,{})})}),e(Z,{onClick:ee,size:"sm",children:S("userDialog.resetUsage")}),e(Z,{onClick:V,size:"sm",children:S("userDialog.revokeSubscription")})]})}),e(g,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(Z,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:w?e(De,{size:"xs"}):void 0,disabled:ie,children:S(y?"userDialog.editUser":"createUser")})})]})})]})})})]})},Pi=({tags:t,onChange:s})=>{const{proxyTags:n,onCreateProxy:o}=pe(),{onEditingSubscription:l}=$(),{t:i}=te(),d=t.split(",").filter(h=>h.length>0),x=n.reduce((h,m)=>({...h,[m.tag]:m}),{}),y=b.exports.useRef(null),[R,w]=b.exports.useState(""),C=h=>{w(h.target.value)};return r(H,{children:[e(Vn,{onDragEnd:h=>{if(!h.destination)return;const m=Array.from(d),[_]=m.splice(h.source.index,1);m.splice(h.destination.index,0,_),s(m.join(","))},children:e(Gn,{droppableId:"droppable",children:h=>{const m=d;return r(vt,{w:"full",...h.droppableProps,ref:h.innerRef,children:[m.map((_,T)=>{const c=x[_]||{tag:_,servers:["Not Found"]},a=c.servers[0].split("->")[0].trimEnd()+(c.servers.length>1?"...":"");let u="primary";return x[_]||(u="red"),e(qn,{index:T,draggableId:c.tag,children:S=>r(Yn,{ref:S.innerRef,...S.draggableProps,...S.dragHandleProps,w:"fit-content",size:"md",pl:"3",pr:"3",mb:"1",borderRadius:"full",variant:"solid",cursor:"default",colorScheme:u,children:[e(Zn,{boxSize:"18px",as:Ci}),r(Te,{isLazy:!0,trigger:"hover",placement:"top",children:[e(Le,{children:e(Qn,{height:"full",cursor:"default",children:r(Xn,{children:[c.tag," -> ",a]})})}),r(Ue,{w:"full",children:[e(Ae,{}),e(vt,{p:"2",spacingY:"1",pl:"3",pr:"3",w:"full",alignItems:"flex-start",color:"gray.800",_dark:{color:"whiteAlpha.900"},children:c.servers.map((M,P)=>e(p,{fontSize:"sm",children:M},P))})]})]}),e(Jn,{onClick:()=>{const M=m.filter(P=>P!==_);s(M.join(","))}})]})},c.tag)}),h.placeholder]})}})}),n.length==0&&r(H,{mt:3,children:[e(p,{children:i("userDialog.noTags")}),e(zi,{onClick:()=>{l(!0),o(!0)},cursor:"pointer",boxSize:"32px",_dark:{'path[fill="#ccc"]':{fill:"primary.300"}},_light:{'path[fill="#ccc"]':{fill:"primary.500"}}})]}),n.length>0&&r(H,{w:"full",children:[r(g,{w:"full",children:[r(nt,{children:[e(It,{height:"8",pointerEvents:"none",children:e(vi,{})}),e(rt,{pl:10,size:"sm",borderRadius:"md",placeholder:i("search"),value:R,borderColor:"light-border",onChange:C}),e(ht,{height:"8",children:R.length>0&&e(Y,{onClick:()=>w(""),"aria-label":"clear",size:"xs",variant:"ghost",children:e(ki,{})})})]}),e(j,{w:"36px"})]}),r(g,{w:"full",children:[e(me,{ref:y,size:"sm",children:n.map(h=>{const _=d.some(c=>c===h.tag),T=R&&h.tag.toLowerCase().indexOf(R.toLowerCase())<0;return _||T?null:e("option",{value:h.tag,children:h.tag},h.tag)})}),e(Y,{size:"sm","aria-label":"Add Tags",icon:e(_i,{}),onClick:()=>{const h=d,m=y.current.value;s([...h,m].join(","))}})]})]})]})},Fi=t=>b.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},b.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),b.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),b.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),b.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),b.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),b.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),b.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),b.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),b.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),b.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),b.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),b.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),b.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),b.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),b.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),Ni=t=>{if(!t)return null;const s=new Date(`${t}Z`);return Math.floor(s.getTime()/1e3)},pn=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),n=Ni(t);return!t||n===null?e(j,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):s-n<=60?e(j,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(j,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Mi=t=>{if(!t)return null;const s=new Date(t+"Z");return Math.floor(s.getTime()/1e3)},mn=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),n=Mi(t),o=n?s-n:null,l=n?gr(n):{status:"",time:"Not Connected Yet"};return e(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:o&&o<=60?"Online":o?`${l.time} ago`:l.time})},Oi=E(fo,{baseStyle:{w:4,h:4}}),Wi=E(bo,{baseStyle:{w:4,h:4}}),gn=5;function $i(t,s,n){if(n<gn)throw new Error(`Must allow at least ${gn} page items`);if(n%2===0)throw new Error("Must allow odd number of page items");if(t<n)return[...new Array(t).keys()];const o=Math.max(0,Math.min(t-n,s-Math.floor(n/2))),l=new Array(n);for(let i=0;i<n;i+=1)l[i]=i+o;return l[0]>0&&(l[0]=0,l[1]="prev-more"),l[l.length-1]<t-1&&(l[l.length-1]=t-1,l[l.length-2]="next-more"),l}const sr=({onChange:t,total:s,limit:n,offset:o})=>{const l=(o||0)/(n||1),i=Math.ceil(s/(n||1)),d=$i(i,l,7),x=w=>{t(w,n)},y=w=>{t(l,parseInt(w.target.value)),Ko(w.target.value)},{t:R}=te();return r(g,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(j,{order:{base:2,md:1},children:r(g,{children:[r(me,{minW:"60px",value:n,onChange:y,size:"sm",rounded:"md",children:[e("option",{children:"10"}),e("option",{children:"20"}),e("option",{children:"30"})]}),e(p,{whiteSpace:"nowrap",fontSize:"sm",children:R("itemsPerPage")})]})}),r(xo,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(Z,{leftIcon:e(Oi,{}),onClick:x.bind(null,l-1),isDisabled:l===0||i===0,children:R("previous")}),d.map(w=>typeof w=="string"?e(Z,{children:"..."},w):e(Z,{variant:w===l?"solid":"outline",onClick:x.bind(null,w),children:w+1},w)),e(Z,{rightIcon:e(Wi,{}),onClick:x.bind(null,l+1),isDisabled:l+1===i||i===0,children:R("next")})]})]})},Cr=({expiryDate:t,status:s,compact:n=!1,showDetail:o=!0,extraText:l})=>{const{t:i}=te(),d=gr(t),x=_t[s].icon;return r(Ge,{children:[r(re,{colorScheme:_t[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:n?1:2,alignItems:"center",children:[e(x,{w:n?3:4}),o&&r(p,{textTransform:"capitalize",fontSize:n?".7rem":".875rem",lineHeight:n?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&i(`status.${s}`),l&&`: ${l}`]})]}),o&&t&&e(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(d.status,{time:d.time})})]})},ji=E(Fi),Wt={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Bi=E(yo,Wt),Hi=E(Kn,Wt),fn=E(es,Wt),Vi=E(mr,Wt),Gi=E(Hr,Wt),qi=E(Ot,Wt),Yi=E(Kn,{baseStyle:{width:"15px",height:"15px"}}),Zi=t=>{for(var s=0;s<Ur.length;s++){const n=Ur[s];if(n.value==t)return n.title}return"No"},Qi=t=>{const{used:s,total:n,dataLimitResetStrategy:o,totalUsedTraffic:l}=t,i=n===0||n===null;return e(g,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:r(p,{children:[Oe(s)," /"," ",i?e(p,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Oe(n)]})})},bn=t=>{const{used:s,total:n,dataLimitResetStrategy:o,totalUsedTraffic:l,...i}=t,d=n===0||n===null,x=!d&&s/n*100>=100;return r(Ge,{children:[e(So,{orientation:"horizontal",value:d?100:Math.min(s/n*100,100),colorScheme:x?"red":"primary",...i,children:e(wo,{h:"6px",borderRadius:"full",children:e(Co,{borderRadius:"full"})})}),r(g,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[r(p,{children:[Oe(s)," /"," ",d?e(p,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Oe(n)+(o&&o!=="no_reset"?" "+Re("userDialog.resetStrategy"+Zi(o)):"")]}),r(p,{children:[Re("usersTable.total"),": ",Oe(l)]})]})]})},ge=({sort:t,column:s})=>t.includes(s)?e(Yi,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,Xi=t=>{const{filters:s,users:{users:n},users:o,onEditingUser:l,onFilterChange:i}=$(),{t:d}=te(),[x,y]=b.exports.useState(void 0),R=kt({base:120,lg:72})||72,[w,C]=b.exports.useState(`${R}px`),h=kt({base:!1,md:!0});b.exports.useEffect(()=>{const a=()=>{const u=document.querySelectorAll("#filters")[0];C(`${u.offsetHeight}px`)};window.addEventListener("scroll",a)},[]);const m=n.length!==o.total,_=a=>{let u=s.sort;u.includes(a)?u.startsWith("-")?u="-created_at":u="-"+a:u=a,i({sort:u})},T=a=>{i({status:a.target.value.length>0?a.target.value:void 0})},c=a=>{y(a===x?void 0:a)};return r(j,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(xt,{allowMultiple:!0,display:{base:"block",md:"none"},index:x,children:r(At,{orientation:"vertical",zIndex:"docked",...t,children:[e(Pt,{zIndex:"docked",position:"relative",children:r($e,{children:[e(de,{position:"sticky",top:w,minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:_.bind(null,"username"),children:r(g,{children:[e("span",{children:d("users")}),e(ge,{sort:s.sort,column:"username"})]})}),e(de,{position:"sticky",top:w,minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:r(g,{spacing:0,position:"relative",children:[r(p,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[d("usersTable.status"),s.status?": "+s.status:""]}),r(me,{value:s.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Ge,{}),_focusVisible:{border:"0 !important"},onChange:T,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(de,{position:"sticky",top:w,minW:"100px",cursor:"pointer",pr:0,onClick:_.bind(null,"used_traffic"),children:r(g,{children:[e("span",{children:d("usersTable.dataUsage")}),e(ge,{sort:s.sort,column:"used_traffic"})]})}),e(de,{position:"sticky",top:w,minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(Ft,{children:!h&&(n==null?void 0:n.map((a,u)=>r(b.exports.Fragment,{children:[r($e,{onClick:c.bind(null,u),cursor:"pointer",children:[e(ae,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:r("div",{className:"flex-status",children:[e(pn,{lastOnline:a.online_at}),e(p,{isTruncated:!0,children:a.username})]})}),e(ae,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Cr,{compact:!0,showDetail:!1,expiryDate:a.expire,status:a.status})}),e(ae,{borderBottom:0,minW:"100px",pr:0,children:e(Qi,{totalUsedTraffic:a.lifetime_used_traffic,dataLimitResetStrategy:a.data_limit_reset_strategy,used:a.used_traffic,total:a.data_limit,colorScheme:_t[a.status].bandWidthColor})}),e(ae,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Hi,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:x===u?"rotate(180deg)":"0deg"})})]}),e($e,{className:"collapsible",onClick:c.bind(null,u),children:e(ae,{p:0,colSpan:4,children:r(ut,{border:0,children:[e(pt,{display:"none"}),e(mt,{border:0,cursor:"pointer",px:6,py:3,children:r(H,{justifyContent:"space-between",spacing:"4",children:[r(H,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(p,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:d("usersTable.dataUsage")}),e(j,{width:"full",minW:"230px",children:e(bn,{totalUsedTraffic:a.lifetime_used_traffic,dataLimitResetStrategy:a.data_limit_reset_strategy,used:a.used_traffic,total:a.data_limit,colorScheme:_t[a.status].bandWidthColor})})]}),r(g,{w:"full",justifyContent:"space-between",children:[r(j,{width:"full",children:[e(Cr,{compact:!0,expiryDate:a.expire,status:a.status}),e(mn,{lastOnline:a.online_at})]}),r(g,{children:[e(xn,{user:a}),e(he,{label:d("userDialog.editUser"),placement:"top",children:e(Y,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:S=>{S.stopPropagation(),l(a)},children:e(qi,{})})})]})]})]})})]})})})]},a.username)))})]})}),r(At,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(Pt,{zIndex:"docked",position:"relative",children:r($e,{children:[e(de,{position:"sticky",top:{base:"unset",md:w},minW:"140px",cursor:"pointer",onClick:_.bind(null,"username"),children:r(g,{children:[e("span",{children:d("username")}),e(ge,{sort:s.sort,column:"username"})]})}),e(de,{position:"sticky",top:{base:"unset",md:w},width:"400px",minW:"150px",cursor:"pointer",children:r(g,{position:"relative",gap:"5px",children:[r(p,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[d("usersTable.status"),s.status?": "+s.status:""]}),e(p,{children:"/"}),e(ge,{sort:s.sort,column:"expire"}),e(g,{onClick:_.bind(null,"expire"),children:e(p,{children:d("usersTable.sortByExpire")})}),r(me,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Ge,{}),_focusVisible:{border:"0 !important"},value:s.sort,onChange:T,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(de,{position:"sticky",top:{base:"unset",md:w},width:"350px",minW:"230px",cursor:"pointer",onClick:_.bind(null,"used_traffic"),children:r(g,{children:[e("span",{children:d("usersTable.dataUsage")}),e(ge,{sort:s.sort,column:"used_traffic"})]})}),e(de,{position:"sticky",top:{base:"unset",md:w},width:"200px",minW:"180px"})]})}),r(Ft,{children:[h&&(n==null?void 0:n.map((a,u)=>r($e,{className:qe("interactive",{"last-row":u===n.length-1}),onClick:()=>l(a),children:[e(ae,{minW:"140px",children:r("div",{className:"flex-status",children:[e(pn,{lastOnline:a.online_at}),a.username,e(mn,{lastOnline:a.online_at})]})}),e(ae,{width:"400px",minW:"150px",children:e(Cr,{expiryDate:a.expire,status:a.status})}),e(ae,{width:"350px",minW:"230px",children:e(bn,{totalUsedTraffic:a.lifetime_used_traffic,dataLimitResetStrategy:a.data_limit_reset_strategy,used:a.used_traffic,total:a.data_limit,colorScheme:_t[a.status].bandWidthColor})}),e(ae,{width:"200px",minW:"180px",children:e(xn,{user:a})})]},a.username))),n.length==0&&e($e,{children:e(ae,{colSpan:4,children:e(Ji,{isFiltered:m})})})]})]}),e(sr,{onChange:(a,u)=>{i({...s,limit:u,offset:a*u})},total:o.total,limit:s.limit,offset:s.offset})]})},xn=({user:t})=>{const{setQRCode:s,setSubLink:n}=$(),o=t.links.join(`\r
`),[l,i]=b.exports.useState([-1,!1]);return b.exports.useEffect(()=>{l[1]&&setTimeout(()=>{i([-1,!1])},1e3)},[l]),r(g,{justifyContent:"flex-end",onClick:d=>{d.preventDefault(),d.stopPropagation()},children:[e(tn,{text:t.subscription_url.startsWith("/")?window.location.origin+t.subscription_url:t.subscription_url,onCopy:()=>{i([0,!0])},children:e("div",{children:e(he,{label:l[0]==0&&l[1]?Re("usersTable.copied"):Re("usersTable.copyLink"),placement:"top",children:e(Y,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:l[0]==0&&l[1]?e(fn,{}):e(Vi,{})})})})}),e(tn,{text:o,onCopy:()=>{i([1,!0])},children:e("div",{children:e(he,{label:l[0]==1&&l[1]?Re("usersTable.copied"):Re("usersTable.copyConfigs"),placement:"top",children:e(Y,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:l[0]==1&&l[1]?e(fn,{}):e(Bi,{})})})})}),e(he,{label:"QR Code",placement:"top",children:e(Y,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{s(t.links),n(t.subscription_url)},children:e(Gi,{})})})]})},Ji=({isFiltered:t})=>{const{onCreateUser:s}=$();return r(j,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(ji,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(p,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?Re("usersTable.noUserMatched"):Re("usersTable.noUser")}),!t&&e(Z,{size:"sm",colorScheme:"primary",onClick:()=>s(!0),children:Re("createUser")})]})},or=t=>{if(typeof t=="string")try{t=JSON.parse(t)}catch{}return t},fs={baseStyle:{w:5,h:5}},Ki=E(er,fs),ea=E(Ot,fs),ta=v.object({name:v.string().min(1,{message:"fieldRequired"}),server:v.string().min(1,{message:"fieldRequired"}),port:v.string().min(1,{message:"fieldRequired"}),tag:v.string().min(1,{message:"fieldRequired"}),inbound:v.string().min(1,{message:"fieldRequired"}),settings:v.record(v.string(),v.any())}),ra=t=>({...t}),kr=()=>({id:0,name:"",server:"",inbound:"",tag:"",port:"",settings:{icon:"",hidden:!1,trojan:{security:"tls",fingerprint:"chrome",udp:!0,alpn:"",sni:"",allow_insecure:!1},vless:{security:"tls",fingerprint:"chrome",servername:"",alpn:"",udp:!0,allow_insecure:!1},vmess:{security:"tls",fingerprint:"chrome",servername:"",alpn:"",udp:!0,allow_insecure:!1,ws_opts_path:"",ws_opts_host:""},shadowsocks:{udp:!0}}}),na=()=>{var ne,ce,K,fe,N;const{proxyInbounds:t,editingProxy:s,isCreatingProxy:n,duplicatingProxy:o,onEditingProxy:l,onDuplicatingProxy:i,onCreateProxy:d,deleteProxy:x,editProxy:y,createProxy:R,onAlert:w}=pe(),C=!!s,h=n||C,m=C?"clash.proxy.edited":"clash.proxy.created",[_,T]=b.exports.useState(!1),[c,a]=b.exports.useState(null),[u,S]=b.exports.useState(""),[M,P]=b.exports.useState(""),k=Pe(),{t:f}=te(),z=Ke({defaultValues:kr(),resolver:ft(ta)}),O=L=>t.find(ee=>ee.name===L)||null,le=L=>{if(L){const ee=O(L.inbound);z.reset(ra(L)),a(ee),S(L.port)}else z.reset(kr()),a(null),S("")};b.exports.useEffect(()=>{s&&le(s)},[s,t]),b.exports.useEffect(()=>{n&&le(o||null)},[n,t]);const X=(L,ee)=>{Object.keys(L).map(V=>{ee[V]===void 0&&delete L[V]})},I=L=>{T(!0),P(null);const ee=kr().settings;let V={};L.settings.icon&&(V.icon=L.settings.icon),V.hidden=L.settings.hidden,(c==null?void 0:c.type)=="trojan"?(V.trojan=L.settings.trojan,X(V.trojan,ee.trojan)):(c==null?void 0:c.type)=="vless"?(V.vless=L.settings.vless,X(V.vless,ee.vless)):(c==null?void 0:c.type)=="vmess"?(V.vmess=L.settings.vmess,X(V.vmess,ee.vmess)):(c==null?void 0:c.type)=="shadowsocks"&&(V.shadowsocks=L.settings.shadowsocks,X(V.shadowsocks,ee.shadowsocks));const{...ie}=L;let Q={...ie,id:s==null?void 0:s.id,settings:V};(C?y:R)(Q).then(()=>{k({title:f(m,{name:L.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),J()}).catch(se=>{var Ie,He,Ye,Ze,Qe,Ee;if(((Ie=se==null?void 0:se.response)==null?void 0:Ie.status)===409||((He=se==null?void 0:se.response)==null?void 0:He.status)===400||((Ye=se==null?void 0:se.response)==null?void 0:Ye.status)===404){let xe=(Qe=(Ze=se==null?void 0:se.response)==null?void 0:Ze._data)==null?void 0:Qe.detail;xe.err&&(xe=f(`error.${xe.err}`)),P(xe)}((Ee=se==null?void 0:se.response)==null?void 0:Ee.status)===422&&Object.keys(se.response._data.detail).forEach(xe=>{let A=or(se.response._data.detail[xe]),oe=A;A.err&&(oe=`error.${A.err}`,A=f(oe)),P(A),z.setError(xe,{type:"custom",message:oe})})}).finally(()=>{T(!1)})},J=()=>{le(null),d(!1),l(null),i(null),P(null),w(null)},F=()=>{let L={};L.title="clash.proxy.delete",L.prompt="clash.proxy.deletePrompt",L.yes="delete",L.success="clash.proxy.deleteSuccess",w({title:f(L.title),content:f(L.prompt,{name:s==null?void 0:s.name}),type:"error",yes:f(L.yes),onConfirm:()=>{x(s).then(()=>{k({title:f(L.success,{name:s==null?void 0:s.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),J()}).catch(ee=>{k({title:f("clash.proxy.deleteFail",{name:s==null?void 0:s.name}),status:"warning",isClosable:!0,position:"top",duration:3e3}),J()})}})},W=L=>L&&f(L),G=_;return r(ye,{isOpen:h,onClose:J,size:"lg",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Rt,{...z,children:e(we,{mx:"3",children:r("form",{onSubmit:z.handleSubmit(I),children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:C?e(ea,{color:"white"}):e(Ki,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:f(C?"clash.proxy.edit":"clash.proxy.add")})]})}),e(ke,{mt:3,disabled:G}),e(_e,{children:r(H,{children:[e(g,{w:"full",children:r(D,{isInvalid:!!z.formState.errors.name,children:[r(g,{mb:"1",children:[e(U,{mr:"0",mb:"0",children:f("clash.name")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(dr,{})}),r(Ue,{children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:f("clash.proxy.uniqueInfo")})]})]})]}),e(q,{size:"sm",type:"text",borderRadius:"6px",placeholder:(c==null?void 0:c.name)||"us bwh|01",disabled:G,...z.register("name")}),e(ze,{children:W((ne=z.formState.errors.name)==null?void 0:ne.message)})]})}),r(g,{w:"full",alignItems:"baseline",children:[r(D,{isInvalid:!!z.formState.errors.server,children:[e(U,{children:f("clash.server")}),e(q,{size:"sm",type:"text",borderRadius:"6px",placeholder:(c==null?void 0:c.server)||"bwh-aws.example.com",disabled:G,...z.register("server")}),e(ze,{children:W((ce=z.formState.errors.server)==null?void 0:ce.message)})]}),r(D,{w:"50%",isInvalid:!!z.formState.errors.port,children:[e(U,{children:f("clash.port")}),e(q,{size:"sm",type:"text",borderRadius:"6px",placeholder:(c==null?void 0:c.port)||"1080 | 1080:1081",disabled:G,...z.register("port",{onChange:L=>S(L.target.value)})}),e(ze,{children:W((K=z.formState.errors.port)==null?void 0:K.message)})]})]}),r(g,{w:"full",alignItems:"baseline",children:[r(D,{isInvalid:!!z.formState.errors.inbound,children:[e(U,{children:f("clash.inbound")}),e(me,{disabled:G,size:"sm",placeholder:"Select inbound",...z.register("inbound",{onChange:L=>{const ee=O(L.target.value),V=z.getValues();ee.type=="trojan"&&z.setValue("settings.trojan.security","tls"),(!V.name||(c==null?void 0:c.name)==V.name)&&z.setValue("name",ee.name),(!V.server||(c==null?void 0:c.server)==V.server)&&z.setValue("server",ee.server),(!V.port||(c==null?void 0:c.port)==V.port)&&z.setValue("port",ee.port.toString()),z.clearErrors("port"),z.clearErrors("inbound"),a(ee)}}),children:t.map(L=>e("option",{value:L.name,children:L.name},L.name))}),e(ze,{children:W((fe=z.formState.errors.inbound)==null?void 0:fe.message)})]}),r(D,{isInvalid:!!z.formState.errors.tag,children:[e(g,{mb:"1",children:e(U,{mr:"0",mb:"0",children:f("clash.tag")})}),e(q,{size:"sm",type:"text",borderRadius:"6px",placeholder:"bwh-aws",disabled:G,...z.register("tag")}),e(ze,{children:W((N=z.formState.errors.tag)==null?void 0:N.message)})]})]}),r(g,{w:"full",children:[r(Ct,{w:"full",flexDirection:"column",gap:"1",children:[e(p,{fontSize:"sm",children:f("clash.type")}),e(q,{size:"sm",borderRadius:"6px",disabled:!0,value:(c==null?void 0:c.type)||""})]}),r(Ct,{w:"full",flexDirection:"column",gap:"1",children:[e(p,{fontSize:"sm",children:f("clash.proxy.network")}),e(q,{size:"sm",borderRadius:"6px",disabled:!0,value:(c==null?void 0:c.network)||""})]}),c&&c.type!="shadowsocks"&&r(D,{w:"full",children:[e(U,{children:f("clash.proxy.security")}),c.security=="none"&&r(me,{disabled:G,size:"sm",placeholder:"Select security",...z.register(`settings.${c.type}.security`),children:[e("option",{value:"none",children:"none"},"none"),e("option",{value:"tls",children:"tls"},"tls")]}),c.security!="none"&&e(q,{size:"sm",borderRadius:"6px",disabled:!0,value:c==null?void 0:c.security})]})]}),e(xt,{w:"full",allowToggle:!0,children:r(ut,{border:"0",children:[e(pt,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:r(g,{pt:"4",pb:"2",w:"full",children:[e(Nt,{}),r(p,{whiteSpace:"nowrap",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[f("clash.advanceOption"),e(Ut,{fontSize:"sm",ml:1})]}),e(Nt,{})]})}),e(mt,{w:"full",p:1,children:r(H,{w:"full",children:[e(g,{pt:1,w:"full",gap:"4",children:r(D,{w:"fit-content",display:"flex",alignItems:"center",children:[r(U,{mb:"0",children:[f("clash.hidden"),r(Te,{isLazy:!0,trigger:"hover",placement:"right",children:[e(Le,{children:e(dr,{display:"inline-block"})}),r(Ue,{children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:f("clash.proxy.hiddenInfo")})]})]})]}),e(je,{colorScheme:"primary",...z.register("settings.hidden")})]})}),u.indexOf(":")>0&&r(D,{children:[e(U,{children:f("clash.icon")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...z.register("settings.icon")})]}),c&&c.type!="shadowsocks"&&r(H,{w:"full",children:[c.type=="trojan"&&r(D,{children:[e(U,{children:"SNI"}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...z.register(`settings.${c.type}.sni`)})]}),(c.type=="vmess"||c.type=="vless")&&r(D,{children:[e(U,{children:f("clash.proxy.serverName")}),c.security=="reality"&&e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:!0,value:c.servername}),c.security!="reality"&&e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...z.register(`settings.${c.type}.servername`)}),c.type=="vmess"&&c.network=="ws"&&r(g,{w:"full",paddingTop:"8px",children:[r(D,{children:[e(U,{children:f("clash.proxy.host")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...z.register("settings.vmess.ws_opts_host")})]}),r(D,{w:"50%",children:[e(U,{children:f("clash.proxy.path")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:G,...z.register("settings.vmess.ws_opts_path")})]})]})]}),r(g,{w:"full",children:[r(D,{children:[e(U,{children:"ALPN"}),e(me,{disabled:G,size:"sm",...z.register(`settings.${c.type}.alpn`),children:us.map(L=>e("option",{value:L.value,children:L.title},L.value))})]}),r(D,{children:[e(U,{children:f("clash.proxy.fingerprint")}),e(me,{disabled:G,size:"sm",...z.register(`settings.${c.type}.fingerprint`),children:ps.map(L=>e("option",{value:L.value,children:L.title},L.value))})]})]}),r(g,{pt:1,w:"full",gap:"4",children:[r(D,{w:"fit-content",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:"UDP"}),e(je,{colorScheme:"primary",...z.register(`settings.${c.type}.udp`)})]}),r(D,{w:"fit-content",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:f("clash.proxy.allowInsecure")}),e(je,{colorScheme:"primary",...z.register(`settings.${c.type}.allow_insecure`)})]})]})]}),(c==null?void 0:c.type)=="shadowsocks"&&e(g,{pt:1,w:"full",gap:"4",children:r(D,{w:"fit-content",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:"UDP"}),e(je,{colorScheme:"primary",...z.register(`settings.${c.type}.udp`)})]})})]})})]})}),M&&r(st,{status:"error",children:[e(gt,{}),M]})]})}),e(Fe,{children:r(g,{justifyContent:"space-between",w:"full",gap:3,children:[C&&r(g,{spacing:2,pr:10,children:[e(he,{label:f("delete"),placement:"top",children:e(Y,{"aria-label":"Delete",size:"sm",onClick:F,children:e(ot,{})})}),e(he,{label:f("clash.duplicate"),placement:"top",children:e(Y,{"aria-label":"duplicate proxy",size:"sm",onClick:()=>i(s),children:e(xs,{})})})]}),r(g,{w:"full",justifyItems:"flex-end",children:[e(Z,{onClick:J,size:"sm",variant:"outline",w:"full",disabled:G,children:f("cancel")}),e(Z,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:_?e(De,{size:"xs"}):void 0,w:"full",isDisabled:G||!z.formState.isDirty,children:f(C?"clash.update":"clash.create")})]})]})})]})})})]})},yn=["select","load-balance","relay","url-test","fallback"],sa=["consistent-hashing","round-robin"],oa=v.object({name:v.string().min(1,{message:"fieldRequired"}),tag:v.string().min(1,{message:"fieldRequired"}),type:v.string().min(1,{message:"fieldRequired"}),selected_proxies:v.array(v.string()),settings:v.record(v.string(),v.any())}),_r=()=>({id:0,name:"",tag:"",type:"select",builtin:!1,proxies:"",selected_proxies:[],settings:{relay:{},url_test:{tolerance:150,lazy:!0,url:"http://cp.cloudflare.com/generate_204",interval:300},fallback:{url:"http://cp.cloudflare.com/generate_204",interval:300},load_balance:{strategy:"consistent-hashing",url:"http://cp.cloudflare.com/generate_204",interval:300},select:{disable_udp:!0,filter:""}}}),Sn=t=>({...t,selected_proxies:t.proxies.split(",").filter(s=>s.length>0)}),la=()=>{var ce,K,fe;const{editingProxyGroup:t,duplicatingProxyGroup:s,isCreatingProxyGroup:n,onEditingProxyGroup:o,onCreateProxyGroup:l,onDuplicatingProxyGroup:i,deleteProxyGroup:d,editProxyGroup:x,createProxyGroup:y,onAlert:R,proxyBriefs:w}=pe(),C=!!t,h=n||C,m=C?"clash.proxyGroup.edited":"clash.proxyGroup.created",[_,T]=b.exports.useState(!1),[c,a]=b.exports.useState(""),[u,S]=b.exports.useState(""),M=b.exports.useRef(null),P=Pe(),{t:k}=te(),f=Ke({defaultValues:_r(),resolver:ft(oa)}),z=w.reduce((N,L)=>({...N,[L.id]:L}),{});b.exports.useEffect(()=>{t&&(f.reset(Sn(t)),S(t.type))},[t]),b.exports.useEffect(()=>{n&&(s?(f.reset(Sn(s)),S(s.type)):(f.reset(_r()),S(yn[0])))},[n]);const[O,le]=b.exports.useState(""),X=N=>{le(N.target.value)},I=()=>{le("")},J=N=>{T(!0),a(null);const{selected_proxies:L,...ee}=N;let V={};V.icon=N.settings.icon,N.type=="select"?V.select=N.settings.select:N.type=="url-test"?V.url_test=N.settings.url_test:N.type=="fallback"?V.fallback=N.settings.fallback:N.type=="load-balance"&&(V.load_balance=N.settings.load_balance);let ie={...ee,id:t==null?void 0:t.id,builtin:(t==null?void 0:t.builtin)||!1,proxies:L.join(","),settings:V};(C?x:y)(ie).then(()=>{P({title:k(m,{name:N.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),F()}).catch(Q=>{var se,Ie,He,Ye,Ze,Qe;if(((se=Q==null?void 0:Q.response)==null?void 0:se.status)===409||((Ie=Q==null?void 0:Q.response)==null?void 0:Ie.status)===400||((He=Q==null?void 0:Q.response)==null?void 0:He.status)===404){let Ee=(Ze=(Ye=Q==null?void 0:Q.response)==null?void 0:Ye._data)==null?void 0:Ze.detail;Ee.err&&(Ee=k(`error.${Ee.err}`)),a(Ee)}((Qe=Q==null?void 0:Q.response)==null?void 0:Qe.status)===422&&Object.keys(Q.response._data.detail).forEach(Ee=>{let xe=or(Q.response._data.detail[Ee]),A=xe;xe.err&&(A=`error.${xe.err}`,xe=k(A)),a(xe),f.setError(Ee,{type:"custom",message:A})})}).finally(()=>{T(!1)})},F=()=>{f.reset(_r()),l(!1),o(null),i(null),a(null),T(!1),R(null),I()},W=()=>{R({title:k("clash.proxyGroup.delete"),content:k("clash.proxyGroup.deletePrompt",{name:t==null?void 0:t.name}),type:"error",yes:k("delete"),onConfirm:()=>{d(t).then(()=>{P({title:k("clash.proxyGroup.deleteSuccess",{name:t==null?void 0:t.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),F()}).catch(N=>{P({title:k("clash.proxyGroup.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{R(null)})}})},G=N=>N&&k(N),ne=_;return r(ye,{isOpen:h,onClose:F,size:"md",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Rt,{...f,children:e(we,{mx:"3",children:r("form",{onSubmit:f.handleSubmit(J),children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:C?e(Zr,{color:"white"}):e(Xt,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:k(C?"clash.proxyGroup.edit":"clash.proxyGroup.add")})]})}),e(ke,{mt:3,disabled:ne}),e(_e,{children:r(H,{justifyContent:"space-between",children:[e(g,{w:"full",children:r(D,{isInvalid:!!f.formState.errors.name,children:[r(g,{mb:"1",children:[e(U,{mr:"0",mb:"0",children:k("clash.name")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(dr,{})}),r(Ue,{children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:k("clash.proxyGroup.uniqueInfo")})]})]})]}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:ne,...f.register("name")}),e(ze,{children:G((ce=f.formState.errors.name)==null?void 0:ce.message)})]})}),r(g,{w:"full",alignItems:"baseline",children:[r(D,{w:"60%",children:[e(U,{children:k("clash.type")}),e(me,{disabled:ne||(t==null?void 0:t.builtin),size:"sm",...f.register("type",{onChange:N=>S(N.target.value)}),children:yn.map(N=>e("option",{value:N,children:N},N))}),e(ze,{children:G((K=f.formState.errors.type)==null?void 0:K.message)})]}),r(D,{isInvalid:!!f.formState.errors.tag,children:[e(U,{children:k("clash.tag")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:ne||(t==null?void 0:t.builtin),...f.register("tag")}),e(ze,{children:G((fe=f.formState.errors.tag)==null?void 0:fe.message)})]})]}),r(D,{pt:"2",children:[r(g,{mb:"1",children:[e(U,{mr:"0",mb:"0",children:k("clash.proxies")}),r(Te,{isLazy:!0,placement:"right",children:[e(Le,{children:e(dr,{})}),r(Ue,{children:[e(Ae,{}),e(p,{fontSize:"xs",p:"2",children:k("clash.proxyGroup.proxiesInfo")})]})]})]}),r(H,{w:"full",children:[e(Vn,{onDragEnd:N=>{if(!N.destination)return;const L=Array.from(f.getValues().selected_proxies),[ee]=L.splice(N.source.index,1);L.splice(N.destination.index,0,ee),f.setValue("selected_proxies",L,{shouldDirty:!0})},children:e(Gn,{droppableId:"droppable",children:N=>r(vt,{w:"full",...N.droppableProps,ref:N.innerRef,children:[f.getValues().selected_proxies.map((L,ee)=>{const V=z[L]||{id:L,name:`(${L})`,server:"Not Found",tag:"<Not Found>",builtin:!1};let ie="primary";return z[L]?V.id.startsWith("#")?ie="green":V.id!=="..."&&(ie="purple"):ie="red",e(qn,{index:ee,draggableId:V.id,isDragDisabled:t==null?void 0:t.builtin,children:Q=>r(Yn,{ref:Q.innerRef,...Q.draggableProps,...Q.dragHandleProps,pl:"3",pr:"3",mb:"1",w:"fit-content",size:"md",borderRadius:"full",variant:"solid",cursor:"default",colorScheme:ie,children:[!(t!=null&&t.builtin)&&e(Zn,{boxSize:"18px",as:ya}),r(Te,{isLazy:!0,trigger:"hover",placement:"top",children:[e(Le,{children:e(Qn,{height:"full",cursor:"default",children:r(Xn,{children:[V.name," -> ",V.tag]})})}),!!V.server&&r(Ue,{w:"full",children:[e(Ae,{}),e(p,{p:"2",pl:"3",pr:"3",color:"gray.800",_dark:{color:"whiteAlpha.900"},children:V.server})]})]}),!(t!=null&&t.builtin)&&e(Jn,{onClick:()=>{const Ie=f.getValues().selected_proxies.filter(He=>He!==L);f.setValue("selected_proxies",Ie,{shouldDirty:!0,shouldValidate:!0})}})]})},V.id)}),N.placeholder]})})}),r(H,{w:"full",children:[r(g,{w:"full",children:[r(nt,{children:[e(It,{height:"8",pointerEvents:"none",children:e(Y,{"aria-label":"clear",size:"xs",bgColor:"unset",isDisabled:ne||(t==null?void 0:t.builtin),children:e(lr,{})})}),e(q,{disabled:ne||(t==null?void 0:t.builtin),size:"sm",borderRadius:"md",placeholder:k("search"),value:O,borderColor:"light-border",onChange:X}),r(ht,{height:"8",children:[_&&e(De,{size:"xs"}),O.length>0&&e(Y,{onClick:I,"aria-label":"clear",size:"xs",variant:"ghost",children:e(fr,{})})]})]}),e(j,{w:"36px"})]}),r(g,{w:"full",children:[e(me,{ref:M,disabled:ne||(t==null?void 0:t.builtin),size:"sm",children:w.map(N=>{const ee=f.getValues().selected_proxies.some(se=>N.id===se),V=`#${t==null?void 0:t.id}`,ie=`${N.name} -> ${N.tag}`,Q=O&&ie.toLowerCase().indexOf(O.toLowerCase())<0;return ee||N.id==V||Q?null:e("option",{value:N.id,children:ie},N.id)})}),e(Y,{size:"sm","aria-label":"Add Proxy",isDisabled:ne||(t==null?void 0:t.builtin),icon:e(Xt,{}),onClick:()=>{const N=f.getValues().selected_proxies,L=M.current.value,ee=z[L];N.some(ie=>{var Q;return ee.name===((Q=z[ie])==null?void 0:Q.name)})?P({title:k("clash.proxy.exists",{name:z[L].name}),status:"error",isClosable:!0,position:"top",duration:3e3}):(f.clearErrors("proxies"),f.setValue("selected_proxies",[...N,L],{shouldDirty:!0}))}})]})]})]})]}),e(xt,{w:"full",allowToggle:!0,children:r(ut,{border:"0",children:[e(pt,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:r(g,{pt:"4",pb:"2",w:"full",children:[e(Nt,{}),r(p,{whiteSpace:"nowrap",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[k("clash.advanceOption"),e(Ut,{fontSize:"sm",ml:1})]}),e(Nt,{})]})}),e(mt,{w:"full",p:1,children:r(H,{w:"full",children:[e(g,{pt:1,w:"full",gap:"4",children:r(D,{w:"fit-content",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:k("clash.hidden")}),e(je,{colorScheme:"primary",...f.register("settings.hidden")})]})}),r(D,{children:[e(U,{children:k("clash.icon")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:ne,...f.register("settings.icon")})]}),u=="load-balance"&&r(H,{w:"full",children:[r(D,{children:[e(U,{children:k("clash.strategy")}),e(me,{size:"sm",...f.register("settings.load_balance.strategy"),children:sa.map(N=>e("option",{value:N,children:N},N))})]}),r(D,{children:[e(U,{children:k("clash.url")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...f.register("settings.load_balance.url")})]}),r(D,{children:[e(U,{children:k("clash.interval")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...f.register("settings.load_balance.interval")})]})]}),u=="url-test"&&r(H,{w:"full",children:[r(D,{children:[e(U,{children:k("clash.url")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...f.register("settings.url_test.url")})]}),r(D,{children:[e(U,{children:k("clash.interval")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...f.register("settings.url_test.interval")})]}),r(D,{children:[e(U,{children:k("clash.tolerance")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...f.register("settings.url_test.tolerance")})]}),r(D,{pt:"1",display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:"lazy"}),e(je,{colorScheme:"primary",...f.register("settings.url_test.lazy")})]})]}),u=="fallback"&&r(H,{w:"full",children:[r(D,{children:[e(U,{children:k("clash.url")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...f.register("settings.fallback.url")})]}),r(D,{children:[e(U,{children:k("clash.interval")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...f.register("settings.fallback.interval")})]})]}),u=="select"&&r(H,{w:"full",children:[r(D,{children:[e(U,{children:k("clash.filter")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:t==null?void 0:t.builtin,...f.register("settings.select.filter")})]}),r(D,{pt:2,display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:"disable-udp"}),e(je,{colorScheme:"primary",disabled:t==null?void 0:t.builtin,...f.register("settings.select.disable_udp")})]})]})]})})]})}),c&&r(st,{status:"error",children:[e(gt,{}),c]})]})}),e(Fe,{children:r(g,{justifyContent:"space-between",w:"full",gap:3,children:[C&&r(g,{spacing:2,pr:5,children:[e(he,{isDisabled:t.builtin,label:k("delete"),placement:"top",children:e(Y,{isDisabled:t.builtin,"aria-label":"Delete",size:"sm",onClick:W,children:e(ot,{})})}),e(he,{isDisabled:t.builtin,label:k("clash.duplicate"),placement:"top",children:e(Y,{isDisabled:t.builtin,"aria-label":"Duplicate proxy group",size:"sm",onClick:()=>i(t),children:e(xs,{})})})]}),r(g,{w:"full",justifyItems:"flex-end",children:[e(Z,{onClick:F,size:"sm",variant:"outline",w:"full",disabled:ne,children:k("cancel")}),e(Z,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:_?e(De,{size:"xs"}):void 0,w:"full",isDisabled:ne||!f.formState.isDirty,children:k(C?"clash.update":"clash.create")})]})]})})]})})})]})},Ar=[{name:"DOMAIN",example:"www.google.com"},{name:"DOMAIN-SUFFIX",example:"google.com"},{name:"DOMAIN-KEYWORD",example:"google"},{name:"GEOIP",noResolve:!0,example:"cn"},{name:"GEOSITE",message:"clash.rule.supportGEOSITE",example:"google"},{name:"IP-CIDR",noResolve:!0,example:"127.0.0.0/8"},{name:"IP-CIDR6",noResolve:!0,example:"2620:0:2d0:200::7/32"},{name:"RULE-SET",example:"providername"},{name:"SRC-IP-CIDR",example:"192.168.1.201/32"},{name:"SRC-PORT",example:"80"},{name:"DST-PORT",example:"8080"},{name:"PROCESS-NAME",example:"onedrive"},{name:"PROCESS-PATH",example:"/usr/bin/curl"},{name:"NETWORK",message:"clash.rule.supportNETWORK",example:"tcp udp"},{name:"SCRIPT",message:"clash.rule.supportSCRIPT",example:"script shortcut"},{name:"AND",message:"clash.rule.supportLOGIC",example:"((DOMAIN,google.com),(NETWORK,UDP))"},{name:"OR",message:"clash.rule.supportLOGIC",example:"((NETWORK,UDP),(DOMAIN,google.com))"},{name:"NOT",message:"clash.rule.supportLOGIC",example:"((DOMAIN,google.com))"}],ia=v.object({content:v.string().min(1,{message:"fieldRequired"}),type:v.string().min(1,{message:"fieldRequired"}),ruleset:v.string().min(1,{message:"fieldRequired"}),policy:v.string(),priority:v.boolean(),no_resolve:v.boolean()}),vr=t=>({id:0,type:"DOMAIN-SUFFIX",content:"",option:"",policy:"",priority:!1,no_resolve:!1,ruleset:t||"DIRECT"}),aa=t=>{var s;return{...t,no_resolve:((s=t.option)==null?void 0:s.includes("no-resolve"))||!1,priority:t.priority==1}},Et=t=>Ar.filter(s=>s.name===t)[0]||Ar[0],ca=()=>{var J;const{ruleFilter:t,editingRule:s,isCreatingRule:n,onEditingRule:o,onCreateRule:l,onEditingRuleset:i,deleteRule:d,editRule:x,createRule:y,rulesets:R,onAlert:w}=pe(),C=!!s,h=n||C,m=C?"clash.rule.edited":"clash.rule.created",[_,T]=b.exports.useState(!1),[c,a]=b.exports.useState(""),[u,S]=b.exports.useState(Et("DOMAIN-SUFFIX")),M=Pe(),{t:P}=te(),k=Ke({defaultValues:vr(null),resolver:ft(ia)});b.exports.useEffect(()=>{s&&(k.reset(aa(s)),S(Et(s.type)))},[s]),b.exports.useEffect(()=>{n&&(S(Et("DOMAIN-SUFFIX")),k.reset(vr(t.ruleset)))},[n,t]);const f=F=>{T(!0),a(null);const{no_resolve:W,priority:G,...ne}=F;let ce={...ne,id:s==null?void 0:s.id,priority:G?1:0,option:W&&Et(F.type).noResolve?"no-resolve":""};(C?x:y)(ce).then(()=>{M({title:P(m,{name:F.content}),status:"success",isClosable:!0,position:"top",duration:3e3}),z()}).catch(K=>{var fe,N,L,ee,V,ie;if(((fe=K==null?void 0:K.response)==null?void 0:fe.status)===409||((N=K==null?void 0:K.response)==null?void 0:N.status)===400||((L=K==null?void 0:K.response)==null?void 0:L.status)===404){let Q=(V=(ee=K==null?void 0:K.response)==null?void 0:ee._data)==null?void 0:V.detail;Q.err&&(Q=P(`error.${Q.err}`)),a(Q)}((ie=K==null?void 0:K.response)==null?void 0:ie.status)===422&&Object.keys(K.response._data.detail).forEach(Q=>{let se=or(K.response._data.detail[Q]),Ie=se;se.err&&(Ie=`error.${se.err}`,se=P(Ie)),a(se),k.setError(Q,{type:"custom",message:Ie})})}).finally(()=>{T(!1)})},z=()=>{k.reset(vr(t.ruleset)),l(!1),o(null),a(null),S(Et("DOMAIN-SUFFIX"))},O=()=>{w({title:P("clash.rule.delete"),content:P("clash.rule.deletePrompt",{name:s==null?void 0:s.content}),type:"error",yes:P("delete"),onConfirm:()=>{d(s).then(()=>{M({title:P("clash.rule.deleteSuccess",{name:s==null?void 0:s.content}),status:"success",isClosable:!0,position:"top",duration:3e3}),z()}).catch(F=>{M({title:P("clash.rule.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{w(null)})}})},le=()=>{const F=k.getValues().ruleset,W=R.filter(G=>G.name==F)[0];W&&(z(),i(W))},X=F=>F&&P(F),I=_;return r(ye,{isOpen:h,onClose:z,size:"md",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Rt,{...k,children:e(we,{mx:"3",children:r("form",{onSubmit:k.handleSubmit(f),children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:C?e(Zr,{color:"white"}):e(Xt,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:P(C?"clash.rule.edit":"clash.rule.add")})]})}),e(ke,{mt:3,disabled:I}),e(_e,{children:r(H,{justifyContent:"space-between",children:[r(D,{height:"66px",children:[e(U,{children:P("clash.ruleset")}),r(g,{children:[e(me,{disabled:I,size:"sm",...k.register("ruleset"),children:R.map(F=>r("option",{value:F.name,children:[F.name," (",F.policy,")"]},F.id))}),e(Y,{"aria-label":"Edit",size:"sm",onClick:le,children:e(bs,{})})]})]}),r(D,{height:"66px",mb:u.message?4:0,children:[e(U,{children:P("clash.type")}),e(me,{disabled:I,size:"sm",...k.register("type",{onChange:F=>S(Et(F.target.value))}),children:Ar.map(F=>e("option",{value:F.name,children:F.name},F.name))}),u.message&&e(Hn,{fontSize:"xs",mt:1,children:P(u.message)})]}),r(D,{isInvalid:!!k.formState.errors.content,children:[e(U,{children:P("clash.content")}),e(q,{size:"sm",type:"text",borderRadius:"6px",placeholder:u.example,disabled:I,...k.register("content")}),e(ze,{children:X((J=k.formState.errors.content)==null?void 0:J.message)})]}),r(D,{mb:"0px",pt:"10px",children:[e(U,{children:P("clash.policy")}),e(We,{control:k.control,name:"policy",render:({field:F})=>e(ts,{isDisabled:I,...F,children:e(rs,{direction:"row",spacing:"6",children:["","DIRECT","PROXY","REJECT"].map(W=>e(ns,{value:W,size:"md",colorScheme:"primary",children:e(p,{fontSize:"sm",children:W||"RULESET"})},W||"RULESET"))})})})]}),r(g,{w:"full",pt:"2",children:[u.noResolve&&r(D,{display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:P("clash.rule.noResolve")}),e(je,{colorScheme:"primary",...k.register("no_resolve")})]}),r(D,{display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:P("clash.rule.priority")}),e(je,{disabled:I,colorScheme:"primary",...k.register("priority")})]})]}),c&&r(st,{status:"error",children:[e(gt,{}),c]})]})}),e(Fe,{mt:"3",children:r(g,{justifyContent:"space-between",w:"full",gap:3,children:[C&&e(he,{label:P("delete"),placement:"top",children:e(Y,{"aria-label":"Delete",size:"sm",onClick:O,children:e(ot,{})})}),r(g,{w:"full",justifyItems:"flex-end",children:[e(Z,{onClick:z,size:"sm",variant:"outline",w:"full",disabled:I,children:P("cancel")}),e(Z,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:_?e(De,{size:"xs"}):void 0,w:"full",isDisabled:I||!k.formState.isDirty,children:P(C?"clash.update":"clash.create")})]})]})})]})})})]})},da=E(er,{baseStyle:{w:5,h:5}}),ha=E(Ot,{baseStyle:{w:5,h:5}}),wn=()=>({id:0,name:"",builtin:!1,policy:"PROXY",settings:{as_provider:!1,type:"http",behavior:"classical",format:"yaml",interval:3600}}),ua=()=>{const{editingRuleset:t,isCreatingRuleset:s,onEditingRuleset:n,onCreateRuleset:o,deleteRuleset:l,editRuleset:i,createRuleset:d,onRuleFilterChange:x,onAlert:y}=pe(),R=!!t,w=s||R,C=R?"clash.ruleset.edited":"clash.ruleset.created",[h,m]=b.exports.useState(!1),[_,T]=b.exports.useState(""),[c,a]=b.exports.useState(!1),u=Pe(),{t:S}=te(),M=Ke({defaultValues:wn()});b.exports.useEffect(()=>{var O;t&&(M.reset(t),a((O=t.settings.as_provider)!=null?O:!1))},[t]);const P=O=>{m(!0),T(null);let le=O;(R?i:d)(le).then(()=>{u({title:S(C,{name:O.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),x({ruleset:le.name,offset:0}),k()}).catch(X=>{var I,J,F,W,G,ne;if(((I=X==null?void 0:X.response)==null?void 0:I.status)===409||((J=X==null?void 0:X.response)==null?void 0:J.status)===400||((F=X==null?void 0:X.response)==null?void 0:F.status)===404){let ce=(G=(W=X==null?void 0:X.response)==null?void 0:W._data)==null?void 0:G.detail;ce.err&&(ce=S(`error.${ce.err}`)),T(ce)}((ne=X==null?void 0:X.response)==null?void 0:ne.status)===422&&Object.keys(X.response._data.detail).forEach(ce=>{let K=or(X.response._data.detail[ce]),fe=K;K.err&&(fe=`error.${K.err}`,K=S(fe)),T(K),M.setError(ce,{type:"custom",message:K})})}).finally(()=>{m(!1)})},k=()=>{M.reset(wn()),o(!1),a(!1),n(null),T(null),y(null)},f=()=>{y({title:S("clash.ruleset.delete"),content:S("clash.ruleset.deletePrompt",{name:t==null?void 0:t.name}),type:"error",yes:S("delete"),onConfirm:()=>{l(t).then(()=>{u({title:S("clash.ruleset.deleteSuccess",{name:t==null?void 0:t.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),k()}).catch(O=>{u({title:S("clash.ruleset.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{y(null)})}})},z=h;return r(ye,{isOpen:w,onClose:k,size:"md",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Rt,{...M,children:e(we,{mx:"3",children:r("form",{onSubmit:M.handleSubmit(P),children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:R?e(ha,{color:"white"}):e(da,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:S(R?"clash.ruleset.edit":"clash.ruleset.add")})]})}),e(ke,{mt:3,disabled:z}),e(_e,{children:r(H,{justifyContent:"space-between",children:[r(D,{mb:"0",isInvalid:!!M.formState.errors.name,children:[e(U,{children:S("clash.name")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:z||(t==null?void 0:t.builtin),...M.register("name")})]}),r(D,{mb:"0px",pt:"10px",children:[e(U,{children:S("clash.policy")}),e(We,{control:M.control,name:"policy",render:({field:O})=>e(ts,{isDisabled:z||(t==null?void 0:t.builtin),...O,children:e(rs,{direction:"row",spacing:"6",children:["DIRECT","PROXY","REJECT"].map(le=>e(ns,{value:le,size:"md",colorScheme:"primary",children:e(p,{fontSize:"sm",children:le})},le))})})})]}),e(xt,{w:"full",allowToggle:!0,children:r(ut,{border:"0",children:[e(pt,{display:"flex",justifyContent:"space-between",px:0,py:1,borderRadius:3,_hover:{bg:"transparent"},children:r(g,{pt:"4",pb:"2",w:"full",children:[e(Nt,{}),r(p,{whiteSpace:"nowrap",fontSize:"xs",color:"gray.600",_dark:{color:"gray.500"},pl:1,children:[S("clash.advanceOption"),e(Ut,{fontSize:"sm",ml:1})]}),e(Nt,{})]})}),e(mt,{w:"full",p:1,children:r(H,{w:"full",children:[r(D,{mb:"10px",children:[e(U,{children:S("clash.icon")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:z,...M.register("settings.icon")})]}),r(D,{display:"flex",alignItems:"center",children:[e(U,{mb:"0",children:S("clash.ruleset.asRuleProvider")}),e(je,{disabled:z||(t==null?void 0:t.builtin),colorScheme:"primary",...M.register("settings.as_provider",{onChange:O=>a(O.target.checked)})})]}),c&&r(H,{w:"full",children:[r(g,{w:"full",children:[r(D,{children:[e(U,{children:S("clash.behavior")}),e(me,{size:"sm",...M.register("settings.behavior"),children:["classical","domain","ipcidr"].map(O=>e("option",{value:O,children:O},O))})]}),r(D,{children:[e(U,{children:S("clash.type")}),e(me,{size:"sm",...M.register("settings.type"),children:["http","file"].map(O=>e("option",{value:O,children:O},O))})]})]}),r(g,{w:"full",children:[r(D,{children:[e(U,{children:S("clash.format")}),e(me,{size:"sm",...M.register("settings.format"),children:["yaml","text"].map(O=>e("option",{value:O,children:O},O))})]}),r(D,{children:[e(U,{children:S("clash.interval")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...M.register("settings.interval")})]})]}),r(D,{children:[e(U,{children:S("clash.url")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...M.register("settings.url")})]}),r(D,{children:[e(U,{children:S("clash.path")}),e(q,{size:"sm",type:"text",borderRadius:"6px",...M.register("settings.path")})]})]})]})})]})}),_&&r(st,{status:"error",children:[e(gt,{}),_]})]})}),e(Fe,{mt:"3",children:r(g,{justifyContent:"space-between",w:"full",gap:3,children:[R&&e(he,{label:S("delete"),placement:"top",children:e(Y,{"aria-label":"Delete",size:"sm",onClick:f,children:e(ot,{})})}),r(g,{w:"full",justifyItems:"flex-end",children:[e(Z,{onClick:k,size:"sm",variant:"outline",w:"full",disabled:z,children:S("cancel")}),e(Z,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:h?e(De,{size:"xs"}):void 0,w:"full",isDisabled:z||!M.formState.isDirty,children:S(R?"clash.update":"clash.create")})]})]})})]})})})]})},pa=E(Ot,{baseStyle:{w:5,h:5}}),ma=()=>{const{loading:t,editingSetting:s,onEditingSetting:n,editSetting:o}=pe(),l=s!==null,{colorMode:i}=zt(),{t:d}=te(),x=Pe(),[y,R]=b.exports.useState((s==null?void 0:s.content)||""),w=()=>{n(null)},C=()=>{o({name:s.name,content:y}).then(()=>{x({title:d("clash.setting.savedSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})})};return b.exports.useEffect(()=>{s&&R(s.content)},[s]),r(ye,{isOpen:l,onClose:w,size:"4xl",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:e(pa,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:d("clash.setting.edit")})]})}),e(ke,{mt:3}),e(_e,{children:e(H,{w:"full",children:e(ko,{value:y,height:"500px",theme:i,extensions:[_o.define(vo)],onChange:h=>R(h)})})}),e(Fe,{children:e(g,{w:"full",justifyContent:"flex-end",children:e(Z,{colorScheme:"primary",size:"sm",minW:40,isDisabled:t||y==(s==null?void 0:s.content),onClick:C,px:5,children:d("clash.save")})})})]})]})},ga=v.object({name:v.string().min(1,{message:"Required"}),tag:v.string().min(1,{message:"Required"}),prefix:v.string().min(1,{message:"Required"}),url:v.string().min(1,{message:"Required"})}),zr=()=>({id:0,name:"",tag:"",prefix:"",url:"",modified_at:""}),fa=t=>({...t}),ba=()=>{var f,z,O,le,X;const{editingLink:t,isCreatingLink:s,onEditingLink:n,onCreateLink:o,deleteLink:l,editLink:i,createLink:d,onAlert:x}=pe(),y=!!t,R=s||y,w=y?"clash.link.edited":"clash.link.created",[C,h]=b.exports.useState(!1),[m,_]=b.exports.useState(""),T=Pe(),{t:c}=te(),a=Ke({defaultValues:zr(),resolver:ft(ga)});b.exports.useEffect(()=>{t&&a.reset(fa(t))},[t]),b.exports.useEffect(()=>{s&&a.reset(zr())},[s]);const u=I=>{h(!0),_(null);let J={...I,id:t==null?void 0:t.id};(y?i:d)(J).then(()=>{T({title:c(w,{name:I.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),S()}).catch(F=>{var W,G,ne,ce,K,fe;if(((W=F==null?void 0:F.response)==null?void 0:W.status)===409||((G=F==null?void 0:F.response)==null?void 0:G.status)===400||((ne=F==null?void 0:F.response)==null?void 0:ne.status)===404){let N=(K=(ce=F==null?void 0:F.response)==null?void 0:ce._data)==null?void 0:K.detail;N.err&&(N=c(`error.${N.err}`)),_(N)}((fe=F==null?void 0:F.response)==null?void 0:fe.status)===422&&Object.keys(F.response._data.detail).forEach(N=>{let L=or(F.response._data.detail[N]),ee=L;L.err&&(ee=`error.${L.err}`,L=c(ee)),_(L),a.setError(N,{type:"custom",message:ee})})}).finally(()=>{h(!1)})},S=()=>{a.reset(zr()),o(!1),n(null),_(null),h(!1)},M=()=>{x({title:c("clash.link.delete"),content:c("clash.link.deletePrompt",{name:t==null?void 0:t.name}),type:"error",yes:c("delete"),onConfirm:()=>{l(t).then(()=>{T({title:c("clash.link.deleteSuccess",{name:t==null?void 0:t.name}),status:"success",isClosable:!0,position:"top",duration:3e3}),S()}).catch(I=>{T({title:c("clash.link.deleteFail"),status:"warning",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{x(null)})}})},P=I=>I&&c(I),k=C;return r(ye,{isOpen:R,onClose:S,size:"md",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Rt,{...a,children:e(we,{mx:"3",children:r("form",{onSubmit:a.handleSubmit(u),children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:y?e(Zr,{color:"white"}):e(Xt,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:c(y?"clash.link.edit":"clash.link.add")})]})}),e(ke,{mt:3,disabled:k}),e(_e,{children:r(H,{justifyContent:"space-between",children:[e(g,{w:"full",children:r(D,{isInvalid:!!a.formState.errors.name,children:[e(g,{mb:"1",children:e(U,{mr:"0",mb:"0",children:c("clash.name")})}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:k,...a.register("name")}),e(ze,{children:P((f=a.formState.errors.name)==null?void 0:f.message)})]})}),r(g,{w:"full",alignItems:"baseline",children:[r(D,{w:"60%",isInvalid:!!a.formState.errors.prefix,children:[e(U,{children:c("clash.link.prefix")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:k,...a.register("prefix")}),e(ze,{children:P((z=a.formState.errors.prefix)==null?void 0:z.message)})]}),r(D,{isInvalid:!!a.formState.errors.tag,children:[e(U,{children:c("clash.tag")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:k,...a.register("tag")}),e(ze,{children:P((O=a.formState.errors.tag)==null?void 0:O.message)})]})]}),e(g,{w:"full",alignItems:"baseline",children:r(D,{isInvalid:!!a.formState.errors.modified_at,children:[e(U,{children:c("clash.modified_at")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:!0,...a.register("modified_at")}),e(ze,{children:P((le=a.formState.errors.modified_at)==null?void 0:le.message)})]})}),e(g,{w:"full",alignItems:"baseline",children:r(D,{isInvalid:!!a.formState.errors.url,children:[e(U,{children:c("clash.url")}),e(q,{size:"sm",type:"text",borderRadius:"6px",disabled:k,...a.register("url")}),e(ze,{children:P((X=a.formState.errors.url)==null?void 0:X.message)})]})}),m&&r(st,{status:"error",children:[e(gt,{}),m]})]})}),e(Fe,{mt:"3",children:r(g,{justifyContent:"space-between",w:"full",gap:3,children:[y&&e(he,{label:c("delete"),placement:"top",children:e(Y,{"aria-label":"Delete",size:"sm",onClick:M,children:e(ot,{})})}),r(g,{w:"full",justifyItems:"flex-end",children:[e(Z,{onClick:S,size:"sm",variant:"outline",w:"full",disabled:k,children:c("cancel")}),e(Z,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:C?e(De,{size:"xs"}):void 0,w:"full",isDisabled:k||!a.formState.isDirty,children:c(y?"clash.update":"clash.create")})]})]})})]})})})]})},Be={baseStyle:{w:5,h:5}},Zr=E(Ot,Be),Xt=E(er,Be),lr=E(Mr,Be),fr=E(pr,Be);E(es,Be);E(mr,Be);const xa=E(Wr,Be),bs=E(Nr,Be);E(Hr,Be);const br=E(Kt,Be);E(zo,Be);const xs=E(Tn,Be),ya=E(Or,Be),dr=E($r,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Sa=()=>{const{isEditingSubscription:t,onEditingSubscription:s}=$(),{t:n}=te();return e(Nn,{isLazy:!0,colorScheme:"primary",lazyBehavior:"keepMounted",children:r(ye,{isOpen:t,onClose:()=>{s(!1)},size:"5xl",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",w:"full",children:[e(Ce,{pt:6,children:r(g,{gap:2,children:[e(ve,{color:"primary",children:e(xa,{color:"white"})}),r(Mn,{children:[e(St,{fontSize:"lg",children:n("clash.proxies")}),e(St,{fontSize:"lg",children:n("clash.proxyGroups")}),e(St,{fontSize:"lg",children:n("clash.links")}),e(St,{fontSize:"lg",children:n("clash.rules")}),e(St,{fontSize:"lg",children:n("clash.setting")})]})]})}),e(ke,{mt:3}),r(_e,{children:[r(On,{children:[e(wt,{children:e(ka,{})}),e(wt,{children:e(va,{})}),e(wt,{children:e(Ia,{})}),e(wt,{children:e(Da,{})}),e(wt,{children:e(wa,{})})]}),e(ca,{}),e(ua,{}),e(la,{}),e(na,{}),e(ma,{}),e(ba,{})]}),e(Fe,{mt:"3"})]})]})})},wa=()=>{const{fetchSettings:t,settings:s,onEditingSetting:n}=pe(),{isEditingSubscription:o}=$();b.exports.useEffect(()=>{o&&t()},[o]);const l=i=>Pr(["/",`/statics/images/${i}.png`]);return e(g,{spacing:6,minH:"sm",alignItems:"baseline",children:s.map(i=>r(_n,{p:6,pl:10,pr:10,borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{borderColor:"gray.600",bg:"gray.750"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",onClick:()=>n(i),children:[e(j,{w:"48px",children:e(Io,{src:l(i.name),alt:i.name})}),e(j,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:i.name})]},i.name))})},Ca=Mt(t=>{pe.getState().onProxyFilterChange({...pe.getState().proxyFilter,offset:0,search:t})},300),ka=()=>{const{isEditingSubscription:t}=$(),{t:s}=te(),{proxyFilter:n,onProxyFilterChange:o,onCreateProxy:l,onEditingProxy:i,fetchProxies:d,fetchProxyInbounds:x,proxies:y,totalProxies:R,loading:w}=pe(),[C,h]=b.exports.useState(""),m=c=>{h(c.target.value),Ca(c.target.value)},_=()=>{h(""),o({...n,offset:0,search:""})},T=c=>{let a=n.sort;a.includes(c)?a.startsWith("-")?a="-modified_at":a="-"+c:a=c,o({sort:a,offset:0})};return b.exports.useEffect(()=>{t&&(n.search="",d(),x())},[t]),r(H,{w:"full",children:[r(g,{w:"full",justifyContent:"space-between",children:[e(g,{children:r(nt,{children:[e(It,{height:"8",pointerEvents:"none",children:e(lr,{})}),e(q,{size:"sm",borderRadius:"md",placeholder:s("search"),value:C,borderColor:"light-border",onChange:m}),r(ht,{height:"8",children:[w&&e(De,{size:"xs"}),C.length>0&&e(Y,{onClick:_,"aria-label":"clear",size:"xs",variant:"ghost",children:e(fr,{})})]})]})}),r(g,{children:[e(Y,{"aria-label":"refresh proxies",disabled:w,onClick:d,size:"sm",variant:"outline",children:e(br,{className:qe({"animate-spin":w})})}),e(Z,{colorScheme:"primary",size:"sm",onClick:()=>l(!0),px:5,children:s("clash.proxy.add")})]})]}),r(j,{overflowX:"auto",w:"full",children:[r(At,{orientation:"vertical",children:[e(Pt,{zIndex:"docked",position:"relative",children:r($e,{children:[e(de,{minW:"30px",pr:"0",cursor:"pointer",onClick:T.bind(null,"id"),children:r(g,{children:[e("span",{children:"id"}),e(ge,{sort:n.sort,column:"id"})]})}),e(de,{minW:"140px",cursor:"pointer",onClick:T.bind(null,"name"),children:r(g,{children:[e("span",{children:s("clash.name")}),e(ge,{sort:n.sort,column:"name"})]})}),e(de,{minW:"140px",cursor:"pointer",onClick:T.bind(null,"server"),children:r(g,{children:[e("span",{children:s("clash.server")}),e(ge,{sort:n.sort,column:"server"})]})}),e(de,{minW:"100px",cursor:"pointer",onClick:T.bind(null,"inbound"),children:r(g,{children:[e("span",{children:s("clash.inbound")}),e(ge,{sort:n.sort,column:"inbound"})]})}),e(de,{minW:"100px",cursor:"pointer",onClick:T.bind(null,"tag"),children:r(g,{children:[e("span",{children:s("clash.tag")}),e(ge,{sort:n.sort,column:"tag"})]})})]})}),e(Ft,{children:y==null?void 0:y.map((c,a)=>r($e,{className:qe("interactive",{"last-row":a===y.length-1}),onClick:()=>i(c),children:[e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.id}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.name}),r(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:[c.server,":",c.port]}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.inbound}),e(ae,{pt:"2.5",pb:"2.5",fontSize:"sm",children:c.tag})]},c.id))})]}),e(sr,{onChange:(c,a)=>{o({...n,limit:a,offset:c*a})},total:R,limit:n.limit,offset:n.offset})]})]})},_a=Mt(t=>{pe.getState().onProxyGroupFilterChange({...pe.getState().proxyGroupFilter,offset:0,search:t})},300),va=()=>{const{isEditingSubscription:t}=$(),{t:s}=te(),{proxyGroupFilter:n,onProxyGroupFilterChange:o,fetchProxyGroups:l,fetchProxyBriefs:i,proxyGroups:d,totalProxyGroups:x,loading:y,onEditingProxyGroup:R,onCreateProxyGroup:w}=pe(),[C,h]=b.exports.useState(""),m=c=>{h(c.target.value),_a(c.target.value)},_=()=>{h(""),o({...n,offset:0,search:""})},T=c=>{let a=n.sort;a.includes(c)?a.startsWith("-")?a="-modified_at":a="-"+c:a=c,o({sort:a,offset:0})};return b.exports.useEffect(()=>{t&&(n.search="",l(),i())},[t]),r(H,{w:"full",children:[r(g,{w:"full",justifyContent:"space-between",children:[e(g,{children:r(nt,{children:[e(It,{height:"8",pointerEvents:"none",children:e(lr,{})}),e(q,{size:"sm",borderRadius:"md",placeholder:s("search"),value:C,borderColor:"light-border",onChange:m}),r(ht,{height:"8",children:[y&&e(De,{size:"xs"}),C.length>0&&e(Y,{onClick:_,"aria-label":"clear",size:"xs",variant:"ghost",children:e(fr,{})})]})]})}),r(g,{children:[e(Y,{"aria-label":"refresh proxy groups",disabled:y,onClick:l,size:"sm",variant:"outline",children:e(br,{className:qe({"animate-spin":y})})}),e(Z,{colorScheme:"primary",size:"sm",onClick:()=>w(!0),px:5,children:s("clash.proxyGroup.add")})]})]}),r(j,{overflowX:"auto",w:"full",children:[r(At,{orientation:"vertical",children:[e(Pt,{zIndex:"docked",position:"relative",children:r($e,{children:[e(de,{minW:"30px",pr:"0",cursor:"pointer",onClick:T.bind(null,"id"),children:r(g,{children:[e("span",{children:"id"}),e(ge,{sort:n.sort,column:"id"})]})}),e(de,{minW:"140px",cursor:"pointer",onClick:T.bind(null,"name"),children:r(g,{children:[e("span",{children:s("clash.name")}),e(ge,{sort:n.sort,column:"name"})]})}),e(de,{minW:"100px",cursor:"pointer",onClick:T.bind(null,"type"),children:r(g,{children:[e("span",{children:s("clash.type")}),e(ge,{sort:n.sort,column:"type"})]})}),e(de,{minW:"140px",cursor:"pointer",onClick:T.bind(null,"tag"),children:r(g,{children:[e("span",{children:s("clash.tag")}),e(ge,{sort:n.sort,column:"tag"})]})}),e(de,{minW:"140px",cursor:"pointer",children:e(g,{children:e("span",{children:s("clash.proxies")})})})]})}),e(Ft,{children:d==null?void 0:d.map((c,a)=>r($e,{className:qe("interactive",{"last-row":a===d.length-1}),onClick:()=>R(c),children:[e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.id}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.name}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.type}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:c.tag}),e(ae,{pt:"2.5",pb:"2.5",fontSize:"sm",children:c.proxies})]},c.id))})]}),e(sr,{onChange:(c,a)=>{o({...n,limit:a,offset:c*a})},total:x,limit:n.limit,offset:n.offset})]})]})},za=Mt(t=>{pe.getState().onLinkFilterChange({...pe.getState().linkFilter,offset:0,search:t})},300),Ia=()=>{const{isEditingSubscription:t}=$(),{t:s}=te(),{linkFilter:n,onLinkFilterChange:o,fetchLinks:l,links:i,totalLinks:d,loading:x,onCreateLink:y,onEditingLink:R}=pe(),[w,C]=b.exports.useState(""),h=_=>{C(_.target.value),za(_.target.value)},m=_=>{let T=n.sort;T.includes(_)?T.startsWith("-")?T="-modified_at":T="-"+_:T=_,o({sort:T,offset:0})};return b.exports.useEffect(()=>{t&&(n.search="",l())},[t]),r(H,{w:"full",children:[r(g,{w:"full",justifyContent:"space-between",children:[e(g,{children:r(nt,{children:[e(It,{height:"8",pointerEvents:"none",children:e(lr,{})}),e(q,{size:"sm",borderRadius:"md",placeholder:s("search"),value:w,borderColor:"light-border",onChange:h})]})}),r(g,{children:[e(Y,{"aria-label":"refresh links",disabled:x,onClick:l,size:"sm",variant:"outline",children:e(br,{className:qe({"animate-spin":x})})}),e(Z,{colorScheme:"primary",size:"sm",onClick:()=>y(!0),px:5,children:s("clash.link.add")})]})]}),r(j,{overflowX:"auto",w:"full",children:[r(At,{orientation:"vertical",children:[e(Pt,{zIndex:"docked",position:"relative",children:r($e,{children:[e(de,{minW:"140px",cursor:"pointer",onClick:m.bind(null,"name"),children:r(g,{children:[e("span",{children:s("clash.name")}),e(ge,{sort:n.sort,column:"name"})]})}),e(de,{minW:"140px",cursor:"pointer",onClick:m.bind(null,"tag"),children:r(g,{children:[e("span",{children:s("clash.tag")}),e(ge,{sort:n.sort,column:"tag"})]})}),e(de,{minW:"250px",cursor:"pointer",onClick:m.bind(null,"modified_at"),children:r(g,{children:[e("span",{children:s("clash.modified_at")}),e(ge,{sort:n.sort,column:"modified_at"})]})}),e(de,{minW:"140px",cursor:"pointer",onClick:m.bind(null,"url"),children:r(g,{children:[e("span",{children:s("clash.url")}),e(ge,{sort:n.sort,column:"url"})]})})]})}),e(Ft,{children:i==null?void 0:i.map(_=>r($e,{onClick:()=>R(_),children:[e(ae,{children:_.name}),e(ae,{children:_.tag}),e(ae,{children:_.modified_at}),e(ae,{children:_.url})]},_.name))})]}),e(sr,{onChange:(_,T)=>{o({...n,limit:T,offset:_*T})},total:d,limit:n.limit,offset:n.offset})]})]})},Ra=Mt(t=>{pe.getState().onRuleFilterChange({...pe.getState().ruleFilter,offset:0,search:t})},300),Da=()=>{const{isEditingSubscription:t}=$(),{t:s}=te(),{ruleFilter:n,onRuleFilterChange:o,fetchRules:l,fetchRulesets:i,onEditingRule:d,onCreateRule:x,onEditingRuleset:y,onCreateRuleset:R,rules:w,totalRules:C,rulesets:h,loading:m}=pe(),[_,T]=b.exports.useState(""),c=h.reduce((f,z)=>({...f,[z.name]:z}),{}),a=f=>{T(f.target.value),Ra(f.target.value)},u=()=>{T(""),o({...n,offset:0,search:""})},S=f=>{const z=h.filter(O=>O.name===f);return z.length?z[0]:null},M=f=>{o(f==="All"?{ruleset:"",offset:0}:{ruleset:f,offset:0})},P=()=>{y(S(n.ruleset))},k=f=>{let z=n.sort;z.includes(f)?z.startsWith("-")?z="-modified_at":z="-"+f:z=f,o({sort:z,offset:0})};return b.exports.useEffect(()=>{n.ruleset&&!S(n.ruleset)&&o({ruleset:"",offset:0})},[h]),b.exports.useEffect(()=>{t&&(n.search="",l(),i())},[t]),r(H,{w:"full",children:[r(g,{w:"full",justifyContent:"space-between",children:[r(g,{children:[e(he,{placement:"top",label:s("clash.ruleset.add"),children:e(Y,{"aria-label":"Add ruleset",size:"sm",onClick:()=>R(!0),children:e(Xt,{})})}),e(he,{isDisabled:!n.ruleset,label:s("clash.ruleset.edit"),placement:"top",children:e(Y,{"aria-label":"Ruleset setting",size:"sm",isDisabled:!n.ruleset,onClick:P,children:e(bs,{})})}),r(me,{size:"sm",value:n.ruleset||"All",onChange:f=>M(f.target.value),children:[e("option",{value:"All",children:"All"},"All"),h.map(f=>r("option",{value:f.name,children:[f.name," (",f.policy,")"]},f.name))]}),r(nt,{children:[e(It,{height:"8",pointerEvents:"none",children:e(lr,{})}),e(q,{size:"sm",borderRadius:"md",placeholder:s("search"),value:_,borderColor:"light-border",onChange:a}),r(ht,{height:"8",children:[m&&e(De,{size:"xs"}),_.length>0&&e(Y,{onClick:u,"aria-label":"clear",size:"xs",variant:"ghost",children:e(fr,{})})]})]})]}),r(g,{children:[e(Y,{"aria-label":"refresh rules",disabled:m,onClick:l,size:"sm",variant:"outline",children:e(br,{className:qe({"animate-spin":m})})}),e(Z,{colorScheme:"primary",size:"sm",onClick:()=>x(!0),px:5,children:s("clash.rule.add")})]})]}),r(j,{overflowX:"auto",w:"full",children:[r(At,{orientation:"vertical",children:[e(Pt,{zIndex:"docked",position:"relative",children:r($e,{children:[e(de,{minW:"170px",cursor:"pointer",onClick:k.bind(null,"type"),children:r(g,{children:[e("span",{children:s("clash.type")}),e(ge,{sort:n.sort,column:"type"})]})}),e(de,{minW:"140px",cursor:"pointer",onClick:k.bind(null,"content"),children:r(g,{children:[e("span",{children:s("clash.content")}),e(ge,{sort:n.sort,column:"content"})]})}),e(de,{minW:"140px",cursor:"pointer",onClick:k.bind(null,"option"),children:r(g,{children:[e("span",{children:s("clash.option")}),e(ge,{sort:n.sort,column:"option"})]})}),e(de,{minW:"140px",children:e(g,{children:e("span",{children:s("clash.ruleset")})})})]})}),e(Ft,{children:w==null?void 0:w.map((f,z)=>{var O;return r($e,{className:qe("interactive",{"last-row":z===w.length-1}),onClick:()=>d(f),children:[e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:f.type}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:e(p,{noOfLines:1,children:f.content})}),e(ae,{pt:"2.5",pb:"2.5",pr:"0",fontSize:"sm",children:f.option}),e(ae,{pt:"2.5",pb:"2.5",fontSize:"sm",children:r(p,{whiteSpace:"nowrap",children:[f.ruleset," (",f.policy||((O=c[f.ruleset])==null?void 0:O.policy),")"]})})]},f.content)})})]}),e(sr,{onChange:(f,z)=>{o({...n,limit:z,offset:f*z})},total:C,limit:n.limit,offset:n.offset})]})]})},Ea={baseStyle:{w:5,h:5}},Cn={error:"red",success:"green",warning:"yellow",info:"blue"},Ta=E(Ln,Ea),La=()=>{const[t,s]=b.exports.useState(!1),{alert:n,onAlert:o}=pe(),{t:l}=te(),i=()=>{o(null)},d=()=>{s(!0),n==null||n.onConfirm()};return b.exports.useEffect(()=>{s(!1)},[n]),r(ye,{isOpen:!!n,onClose:i,size:"sm",children:[e(Se,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),r(we,{mx:"3",mt:150,children:[e(Ce,{pt:6,children:r(g,{spacing:4,children:[e(ve,{color:Cn[(n==null?void 0:n.type)||"error"],children:e(Ta,{w:10})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:n==null?void 0:n.title})]})}),e(ke,{mt:3}),e(_e,{children:n&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(dt,{components:{b:e("b",{})},children:n.content})})}),r(Fe,{display:"flex",children:[e(Z,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(Z,{size:"sm",w:"full",colorScheme:Cn[(n==null?void 0:n.type)||"error"],onClick:d,leftIcon:t?e(De,{size:"xs"}):void 0,children:n==null?void 0:n.yes})]})]})]})},Ua=()=>(b.exports.useEffect(()=>{$.getState().refetchUsers(),pe.getState().fetchProxyTags(),tl()},[]),r(H,{justifyContent:"space-between",minH:"100vh",p:"6",rowGap:4,children:[r(j,{w:"full",children:[e(Al,{}),e(Xo,{mt:"4"}),e(fl,{}),e(Xi,{}),e(Ai,{}),e(ul,{}),e(ci,{}),e(Gl,{}),e(pi,{}),e(gi,{}),e(ti,{}),e(oi,{}),e(hi,{}),e(hl,{}),e(La,{}),e(Sa,{})]}),e(cs,{})]})),Aa=t=>b.exports.createElement("svg",{viewBox:"0 0 747 747",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},b.exports.createElement("path",{d:"M746.671 209.652V77.6572C746.671 72.9384 743.827 68.6832 739.468 66.8811C735.108 65.0738 730.093 66.0739 726.754 69.4072L579.354 216.807C577.453 202.386 570.203 189.203 559.037 179.87C547.875 170.542 533.615 165.744 519.083 166.432C504.551 167.12 490.807 173.24 480.573 183.583L414.375 249.776C412.417 235.391 405.141 222.25 393.985 212.959C382.823 203.662 368.594 198.88 354.083 199.552C339.578 200.224 325.849 206.302 315.594 216.588L274.343 257.828L19.9167 3.41515C16.5781 0.0818157 11.5625 -0.918184 7.20306 0.889149C2.84373 2.69648 0 6.94648 0 11.6651V143.649C0 146.743 1.22917 149.712 3.41667 151.899L191.843 340.339L3.41667 528.753C1.2292 530.94 0 533.909 0 537.003V668.997C0 673.716 2.84373 677.971 7.20306 679.773C11.5624 681.581 16.578 680.58 19.9167 677.247L167.317 529.847C169.285 544.233 176.561 557.358 187.718 566.65C198.869 575.947 213.098 580.728 227.603 580.066C242.103 579.404 255.838 573.342 266.098 563.071L332.295 496.874V496.879C334.259 511.264 341.535 524.395 352.691 533.686C363.853 542.977 378.082 547.759 392.587 547.092C407.093 546.421 420.822 540.348 431.077 530.066L472.327 488.826L726.754 743.239C728.941 745.427 731.91 746.656 735.004 746.656C736.535 746.661 738.056 746.359 739.473 745.77C743.832 743.963 746.671 739.708 746.671 734.989V602.994C746.671 599.901 745.442 596.932 743.254 594.744L554.827 406.318L743.254 217.904H743.259C745.447 215.717 746.676 212.748 746.676 209.654L746.671 209.652ZM23.3373 39.8118L257.844 274.318L208.328 323.818L23.3413 138.818L23.3373 39.8118ZM723.337 706.825L488.831 472.318L538.347 422.818L723.333 607.818L723.337 706.825ZM23.3373 541.825L332.097 233.078C338.764 226.719 347.624 223.172 356.843 223.172C366.056 223.172 374.916 226.719 381.588 233.078C388.151 239.641 391.838 248.548 391.838 257.828C391.838 267.114 388.151 276.016 381.588 282.577L23.3347 640.831L23.3373 541.825ZM249.604 546.575C240.755 555.419 227.864 558.872 215.781 555.638C203.703 552.398 194.265 542.961 191.027 530.883C187.792 518.8 191.245 505.91 200.089 497.06L497.076 200.074C505.92 191.23 518.811 187.772 530.893 191.011C542.971 194.246 552.409 203.678 555.648 215.76C558.888 227.839 555.434 240.73 546.591 249.572L249.604 546.575ZM723.337 204.815L414.577 513.562C407.911 519.926 399.051 523.473 389.832 523.473C380.618 523.473 371.753 519.926 365.087 513.562C358.529 506.999 354.842 498.098 354.842 488.816C354.842 479.535 358.529 470.634 365.087 464.071L723.34 105.818L723.337 204.815Z",fill:"currentColor"})),Pa=v.object({username:v.string().min(1,"login.fieldRequired"),password:v.string().min(1,"login.fieldRequired")}),Fa=E(Aa,{baseStyle:{strokeWidth:"10px",w:12,h:12}}),Na=E(Ro,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),kn=()=>{var C,h;const[t,s]=b.exports.useState(""),[n,o]=b.exports.useState(!1),l=Do(),{t:i}=te();let d=Eo();const{register:x,formState:{errors:y},handleSubmit:R}=Ke({resolver:ft(Pa)});b.exports.useEffect(()=>{Ho(),d.pathname!=="/login"&&l("/login",{replace:!0})},[]);const w=m=>{s("");const _=new FormData;_.append("username",m.username),_.append("password",m.password),_.append("grant_type","password"),o(!0),B("/admin/token",{method:"post",body:_}).then(({access_token:T})=>{Bo(T),l("/")}).catch(T=>{s(T.response._data.detail)}).finally(o.bind(null,!1))};return r(H,{justifyContent:"space-between",minH:"100vh",p:"6",w:"full",children:[r(j,{w:"full",children:[e(g,{justifyContent:"end",w:"full",children:e(ds,{})}),e(g,{w:"full",justifyContent:"center",alignItems:"center",children:r(j,{w:"full",maxW:"340px",mt:"6",children:[r(H,{alignItems:"center",w:"full",children:[e(Fa,{}),e(p,{fontSize:"2xl",fontWeight:"semibold",children:i("login.loginYourAccount")}),e(p,{color:"gray.600",_dark:{color:"gray.400"},children:i("login.welcomeBack")})]}),e(j,{w:"full",maxW:"300px",m:"auto",pt:"4",children:e("form",{onSubmit:R(w),children:r(H,{mt:4,rowGap:2,children:[e(D,{children:e(rt,{w:"full",placeholder:i("username"),...x("username"),error:i((C=y==null?void 0:y.username)==null?void 0:C.message)})}),e(D,{children:e(rt,{w:"full",type:"password",placeholder:i("password"),...x("password"),error:i((h=y==null?void 0:y.password)==null?void 0:h.message)})}),t&&r(st,{status:"error",rounded:"md",children:[e(gt,{}),e(An,{children:t})]}),r(Z,{isLoading:n,type:"submit",w:"full",colorScheme:"primary",children:[e(Na,{marginRight:1}),i("login")]})]})})})]})})]}),e(cs,{})]})},Ma=()=>B("/admin",{headers:{Authorization:`Bearer ${ar()}`}}),Oa=To([{path:"/",element:e(Ua,{}),errorElement:e(kn,{}),loader:Ma},{path:"/login/",element:e(kn,{})}]);function Wa(){return e("main",{className:"p-8",children:e(Lo,{router:Oa})})}ue.extend(Uo);ue.extend(Ao);ue.extend(Po);ue.extend(Fo);ue.extend(No);ss(Mo.get()||"light");Oo.createRoot(document.getElementById("root")).render(e(Rr.StrictMode,{children:e(Wo,{theme:jo,children:e($o,{client:Tr,children:e(Wa,{})})})}));
